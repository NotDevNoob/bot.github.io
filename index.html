<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>No-Co Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="description" content="No-Co - Dashboard per statistiche, classifiche e gestione del server Discord">
    <meta name="theme-color" content="#0a0a0a">
    <link rel="icon" href="favicon.ico">
    <meta property="og:title" content="No-Co Dashboard">
    <meta property="og:description" content="Visualizza statistiche, classifiche e gestisci il server Discord">
    <meta property="og:image" content="https://No-Co.com/og-image.jpg">
    <meta property="og:url" content="https://No-Co.com">

    <style>
        /* Performance optimizations */
        * {
            box-sizing: border-box;
            /* Removed will-change: auto as it can cause performance issues when overused */
        }

        /* Add hardware acceleration only to specific elements that need it */
        .tier-card, .user-item, .filter-button, .profile-content, .nav-item.active {
            transform: translateZ(0); /* Force GPU acceleration only where needed */
        }

        #particleCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            opacity: 0.15;
            pointer-events: none; /* Improve performance by not capturing mouse events */
        }

        :root {
            /* Base colors */
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
            --dark-blue: #003366;
            --light-blue: #66a3ff;
            --background: #0a0a0a;
            --text: #ffffff;
            --border: rgba(255, 255, 255, 0.1);
            --neon-purple: #bc13fe;
            --Anemoia: #ff6b9e;
            --Anemoia-dark: #d44a7a;

            /* New theme colors */
            --primary: #4f46e5;
            --primary-dark: #3730a3;
            --primary-light: #818cf8;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --secondary-light: #34d399;
            --accent: #f97316;
            --accent-dark: #ea580c;
            --accent-light: #fb923c;
            --success: #22c55e;
            --warning: #eab308;
            --danger: #ef4444;
            --info: #3b82f6;

            /* UI elements */
            --card-bg: rgba(26, 26, 26, 0.95);
            --card-border: rgba(255, 255, 255, 0.08);
            --card-hover-border: rgba(255, 255, 255, 0.15);
            --button-bg: rgba(255, 255, 255, 0.08);
            --button-hover-bg: rgba(255, 255, 255, 0.15);
            --input-bg: rgba(255, 255, 255, 0.08);
            --input-focus-bg: rgba(255, 255, 255, 0.12);

            /* Light theme variables (will be used when .light-theme class is applied) */
            --light-background: #f8fafc;
            --light-text: #1e293b;
            --light-card-bg: rgba(255, 255, 255, 0.95);
            --light-card-border: rgba(0, 0, 0, 0.08);
            --light-button-bg: rgba(0, 0, 0, 0.05);
            --light-button-hover-bg: rgba(0, 0, 0, 0.1);

            /* Spacing */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;

            /* Border radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 30px;

            /* Transitions */
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;

            /* Shadows */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.15);
            --shadow-xl: 0 12px 24px rgba(0, 0, 0, 0.2);
        }

        body {
            background: var(--background);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            position: relative;
            overscroll-behavior: none; /* Prevent bounce effects that can cause lag */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background-color var(--transition-normal), color var(--transition-normal);
        }

        /* Light theme styles */
        body.light-theme {
            background: var(--light-background);
            color: var(--light-text);
        }

        /* Header and cards */
        body.light-theme .header-squircle,
        body.light-theme .tier-card,
        body.light-theme .profile-content,
        body.light-theme .sidebar,
        body.light-theme .guide-card,
        body.light-theme .tos-card,
        body.light-theme .privacy-card,
        body.light-theme .stats-card {
            background: var(--light-card-bg);
            border-color: var(--light-card-border);
            box-shadow: var(--shadow-md);
            color: var(--light-text);
        }

        /* Buttons and inputs */
        body.light-theme .filter-button,
        body.light-theme .search-input,
        body.light-theme .nav-item,
        body.light-theme .theme-toggle {
            background: var(--light-button-bg);
            color: var(--light-text);
        }

        body.light-theme .filter-button:hover,
        body.light-theme .nav-item:hover,
        body.light-theme .theme-toggle:hover {
            background: var(--light-button-hover-bg);
        }

        /* User items */
        body.light-theme .user-item {
            background: rgba(0, 0, 0, 0.03);
            color: var(--light-text);
        }

        body.light-theme .user-item:hover {
            background: rgba(0, 0, 0, 0.06);
        }

        /* Chart colors */
        body.light-theme .chart-container canvas {
            background-color: rgba(255, 255, 255, 0.9);
        }

        /* Headers and text */
        body.light-theme h1,
        body.light-theme h2,
        body.light-theme h3,
        body.light-theme h4,
        body.light-theme h5,
        body.light-theme h6,
        body.light-theme p,
        body.light-theme li,
        body.light-theme .tier-label,
        body.light-theme .tier-text,
        body.light-theme .profile-ign,
        body.light-theme .command-group code {
            color: var(--light-text);
        }

        /* Special elements */
        body.light-theme .header-title {
            background: linear-gradient(45deg, #003366, #4f46e5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        body.light-theme .nav-title {
            color: rgba(0, 0, 0, 0.5);
        }

        body.light-theme .coral-link {
            color: var(--primary);
        }

        body.light-theme .coral-link:hover {
            color: var(--primary-dark);
        }

        body.light-theme .command-group code {
            background: rgba(0, 0, 0, 0.1);
            color: var(--primary-dark);
        }

        body.light-theme .guide-section h2,
        body.light-theme .tos-section h2,
        body.light-theme .privacy-section h2 {
            color: var(--primary-dark);
        }

        body.light-theme .guide-card h3,
        body.light-theme .tos-card h3,
        body.light-theme .privacy-card h3 {
            color: var(--primary-dark);
        }

        body.light-theme .command-group h4 {
            color: var(--secondary-dark);
        }

        /* Tier colors in light mode */
        body.light-theme .tier-ht1 { color: #8e44ad; }
        body.light-theme .tier-lt1 { color: #9b59b6; }
        body.light-theme .tier-ht2 { color: #2980b9; }
        body.light-theme .tier-lt2 { color: #3498db; }
        body.light-theme .tier-ht3 { color: #27ae60; }
        body.light-theme .tier-lt3 { color: #2ecc71; }
        body.light-theme .tier-ht4 { color: #d35400; }
        body.light-theme .tier-lt4 { color: #e67e22; }
        body.light-theme .tier-ht5 { color: #c0392b; }
        body.light-theme .tier-lt5 { color: #e74c3c; }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: var(--card-bg);
            border-right: 1px solid var(--card-border);
            padding: var(--spacing-lg) 0;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
            transition: transform var(--transition-normal), background-color var(--transition-normal), border-color var(--transition-normal);
        }

        .sidebar-header {
            padding: 0 var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .logo {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .logo i {
            font-size: 1.5rem;
            background: linear-gradient(45deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-section {
            margin-bottom: var(--spacing-lg);
        }

        .nav-title {
            padding: 0 var(--spacing-lg);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: var(--spacing-sm);
        }

        body.light-theme .nav-title {
            color: rgba(0, 0, 0, 0.5);
        }

        .nav-items {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-item {
            padding: var(--spacing-md) var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            cursor: pointer;
            transition: background-color var(--transition-fast);
            position: relative;
        }

        .nav-item:hover {
            background: var(--button-hover-bg);
        }

        .nav-item.active {
            background: var(--primary);
            color: white;
        }

        body.light-theme .nav-item.active {
            background: var(--primary);
            color: white;
        }

        .nav-item i {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .nav-item-text {
            font-weight: 500;
        }

        .nav-badge {
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
        }

        .sidebar-footer {
            margin-top: auto;
            padding: var(--spacing-lg);
            border-top: 1px solid var(--card-border);
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--button-bg);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: background-color var(--transition-fast);
        }

        .theme-toggle:hover {
            background: var(--button-hover-bg);
        }

        body.light-theme .theme-toggle {
            background: var(--light-button-bg);
        }

        body.light-theme .theme-toggle:hover {
            background: var(--light-button-hover-bg);
        }

        .theme-toggle i {
            font-size: 1.2rem;
        }

        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: var(--spacing-lg);
            transition: margin-left var(--transition-normal);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Mobile sidebar */
        .sidebar-toggle {
            display: none;
            position: fixed;
            bottom: var(--spacing-lg);
            right: var(--spacing-lg);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            transition: background-color var(--transition-fast);
        }

        .sidebar-toggle:hover {
            background: var(--primary-dark);
        }

        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .sidebar-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }

        /* New header design with squircle */
        .header-squircle {
            background: rgba(26, 26, 26, 0.95); /* Increased opacity for better performance */
            border-radius: 24px;
            padding: 25px 35px;
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            /* Removed backdrop-filter for performance */
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Reduced shadow complexity */
            position: relative;
            overflow: hidden;
            border-top: 3px solid var(--light-blue); /* Simple border instead of gradient */
        }

        body.light-theme .header-squircle {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border-top: 3px solid var(--primary);
        }

        /* Removed ::before pseudo-element for performance */

        .header-title {
            font-size: 2.4rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--gold), var(--silver), var(--light-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
            flex: 1;
            letter-spacing: -0.5px;
            position: relative;
        }

        body.light-theme .header-title {
            background: linear-gradient(45deg, #003366, #4f46e5, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
        }

        .header-title::after {
            content: '';
            position: absolute;
            bottom: 0px;
            left: 0;
            width: 0px;
            height: 0px;
            background: var(--gold);
            border-radius: 0px;
        }

        body.light-theme .header-title::after {
            background: var(--primary);
        }

        .filter-buttons {
            display: flex;
            gap: 15px;
            margin: 0 20px;
        }

        .filter-button {
            background: rgba(255, 255, 255, 0.08);
            border: none;
            border-radius: 20px;
            padding: 12px 24px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease; /* Simplified transition */
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-button:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .filter-button.active {
            background: var(--light-blue); /* Solid color instead of gradient */
        }

        .filter-button.Anemoia.active {
            background: var(--Anemoia); /* Solid color instead of gradient */
        }

        body.light-theme .filter-button {
            background: rgba(0, 0, 0, 0.05);
            color: var(--light-text);
        }

        body.light-theme .filter-button:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        body.light-theme .filter-button.active {
            background: var(--primary);
            color: white;
        }

        body.light-theme .filter-button.Anemoia.active {
            background: var(--accent);
            color: white;
        }

        .filter-button i {
            font-size: 1.1rem;
        }

        .search-container {
            position: relative;
        }

        .search-input {
            background: rgba(255, 255, 255, 0.08);
            border: none;
            border-radius: 20px;
            padding: 14px 24px 14px 50px;
            color: white;
            font-size: 1rem;
            font-weight: 500;
            width: 250px;
            transition: width 0.2s ease, background-color 0.2s ease; /* Animate width and background */
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.6);
            font-size: 1.1rem;
        }

        .search-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.12);
            width: 300px;
        }

        body.light-theme .search-input {
            background: rgba(0, 0, 0, 0.05);
            color: var(--light-text);
        }

        body.light-theme .search-input:focus {
            background: rgba(0, 0, 0, 0.08);
        }

        body.light-theme .search-icon {
            color: rgba(0, 0, 0, 0.5);
        }

        /* Mobile search styles */
        .search-toggle {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--dark-blue);
            color: white;
            justify-content: center;
            align-items: center;
            transition: all 0.3s;
        }

        .search-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--light-blue);
        }

        .mobile-search-container {
            display: none;
            width: 100%;
            max-width: 300px;
            margin: 10px auto;
            transition: all 0.3s;
            opacity: 0;
            transform: translateY(-10px);
        }

        .mobile-search-container.active {
            opacity: 1;
            transform: translateY(0);
        }

        @media (max-width: 992px) {
            .header-squircle {
                flex-wrap: wrap;
                gap: 15px;
                padding: 20px;
            }

            .header-title {
                font-size: 1.8rem;
                flex: 100%;
                text-align: center;
            }

            .filter-buttons {
                margin: 0 auto;
            }

            .search-container {
                margin: 0 auto;
            }
        }

        @media (max-width: 768px) {
            .filter-buttons {
                flex: 100%;
                justify-content: center;
            }

            .search-container {
                display: none;
            }

            .search-toggle {
                display: flex;
                margin: 0 auto;
            }

            .mobile-search-container {
                margin-top: 15px;
            }
        }

        @media (max-width: 480px) {
            .header-squircle {
                padding: 15px;
            }

            .header-title {
                font-size: 1.5rem;
            }

            .filter-button {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
        }

        .tiers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            align-items: start;
        }

        @media (min-width: 1200px) {
            .tiers-grid {
                grid-template-columns: repeat(5, minmax(0, 1fr));
            }
        }

        .tier-card {
            background: rgba(26, 26, 26, 0.9); /* Increased opacity for better performance */
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Reduced shadow complexity */
            transition: transform 0.3s ease; /* Only animate transform for better performance */
            /* Removed backdrop-filter for performance */
            border: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            flex-direction: column;
            max-height: 70vh;
            height: auto;
            min-width: 200px;
            max-width: 250px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }

        /* Removed ::before pseudo-element for performance */

        .tier-header {
            flex-shrink: 0;
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .user-list {
            flex: 1;
            overflow-y: auto;
            min-height: 100px;
            padding-right: 5px;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }

        .user-list::-webkit-scrollbar {
            width: 6px;
        }

        .user-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .user-list::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
        }

        .tier-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .tier-card:hover::before {
            opacity: 1;
        }

        .tier-emoji {
            font-size: 2.2rem;
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.4));
            margin-right: 12px;
        }

        .tier-number {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--text), var(--silver), rgba(255, 255, 255, 0.8));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 0.5px;
        }

        .user-item {
            padding: 14px;
            margin: 10px 0;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.05);
            transition: transform 0.2s ease; /* Only animate transform */
            cursor: pointer;
            position: relative;
            border-left: 3px solid transparent; /* Use border instead of pseudo-element */
        }

        .user-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        /* Removed ::before pseudo-element for performance */

        .user-item:hover {
            border-left-color: var(--light-blue);
        }

        .user-item.Anemoia:hover {
            border-left-color: var(--Anemoia);
        }

        .user-item.Anemoia:hover .user-name {
            color: var(--Anemoia);
        }

        .user-item.Anemoia .tier-badge {
            border-color: rgba(255, 107, 158, 0.3);
        }

        .user-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .user-name {
            font-size: 1.05rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.3s ease;
        }

        .user-item:hover .user-name {
            color: var(--light-blue);
        }

        .Anemoia-indicator {
            color: var(--Anemoia);
            font-size: 0.9rem;
            filter: drop-shadow(0 0 3px rgba(255, 107, 158, 0.3));
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        .user-tier {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 2px;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px 20px;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
        }

        .empty-icon {
            font-size: 2rem;
            margin-bottom: 15px;
            opacity: 0.7;
        }

        .empty-text {
            font-size: 1rem;
        }

        .user-tier .sword {
            font-size: 1rem;
            filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.3));
        }

        .user-tier .tier-badge {
            background: linear-gradient(135deg, rgba(0, 51, 102, 0.8), var(--dark-blue));
            padding: 5px 14px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            border: 1px solid rgba(102, 163, 255, 0.2);
        }

        .user-tier .tier-badge.ht {
            background: linear-gradient(135deg, var(--light-blue), #3d7ecc);
            border-color: rgba(102, 163, 255, 0.4);
            box-shadow: 0 2px 10px rgba(102, 163, 255, 0.25);
        }

        .user-item:hover .tier-badge {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .profile-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .profile-content {
            display: grid;
            grid-template-columns: 160px 1fr;
            gap: 30px;
            align-items: start;
            position: relative;
            z-index: 1001;
            max-width: 600px;
            width: 90%;
            padding: 35px;
            background: rgba(26, 26, 26, 0.98); /* Solid background for better performance */
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5); /* Simplified shadow */
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 0.3s ease, transform 0.3s ease; /* Simplified transition */
            overflow: hidden;
            border-top: 4px solid var(--light-blue); /* Simple border instead of gradient */
        }

        .profile-content.active {
            opacity: 1;
            transform: scale(1);
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--light-blue);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            color: var(--text);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            transition: background 0.3s;
        }

        .close-button:hover {
            background: var(--dark-blue);
        }

        .profile-image-container {
            position: relative;
            width: 160px;
            aspect-ratio: 16/9;
        }

        .profile-image {
            width: 100%;
            height: 100%;
            border-radius: 15px;
            object-fit: cover;
            border: 2px solid var(--light-blue);
            box-shadow: 0 0 20px rgba(102, 163, 255, 0.3);
        }

        .tier-squircle {
            position: absolute;
            bottom: -15px;
            right: -15px;
            background: rgba(0, 51, 102, 0.9);
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--gold);
            transform: rotate(15deg);
        }

        .tier-squircle-content {
            transform: rotate(-15deg);
        }

        .tier-emoji-large {
            font-size: 1.8rem;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.3));
        }

        .profile-info {
            padding-top: 15px;
        }

        .profile-ign {
            font-size: 1.8rem;
            margin: 0 0 10px 0;
            background: linear-gradient(45deg, var(--gold), var(--light-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .profile-divider {
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--light-blue), transparent);
            margin: 20px 0;
            opacity: 0.5;
        }

        .tier-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .tier-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tier-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            min-width: 120px;
        }

        .tier-text {
            font-size: 1.2rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .coral-link {
            color: var(--light-blue);
            text-decoration: none;
            transition: color 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .coral-link:hover {
            color: var(--primary-light);
            text-decoration: underline;
        }

        .Anemoia-badge {
            position: absolute;
            top: -10px;
            left: -10px;
            background: linear-gradient(135deg, var(--Anemoia), var(--Anemoia-dark));
            color: white;
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(255, 107, 158, 0.4);
            display: flex;
            align-items: center;
            gap: 5px;
            transform: rotate(-5deg);
            display: none; /* Hidden by default, shown when player has Anemoia flag */
        }

        .Anemoia-badge i {
            font-size: 0.9rem;
        }

        .user-list::-webkit-scrollbar {
            width: 6px;
            background: #1a1a1a;
        }

        .user-list::-webkit-scrollbar-thumb {
            background: var(--dark-blue);
            border-radius: 4px;
        }
        #particleCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            opacity: 0.15;
        }

        :root {
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
            --dark-blue: #003366;
            --light-blue: #66a3ff;
            --background: #0a0a0a;
            --text: #ffffff;
            --border: rgba(255, 255, 255, 0.1);
            --neon-purple: #bc13fe;
        }

        .tier-select-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid var(--light-blue);
            z-index: 1002;
            display: none;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(102, 163, 255, 0.2);
        }

        .tier-option {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--light-blue);
            color: white;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 80px;
            text-align: center;
        }

        .tier-option:hover {
            background: var(--light-blue);
            transform: scale(1.05);
        }

        /* Admin Menu Styles */
        .admin-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--dark-blue);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            z-index: 100;
            transition: all 0.3s;
        }

        @media (max-width: 480px) {
            .admin-button {
                bottom: 15px;
                right: 15px;
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }
        }

        .admin-button:hover {
            background: var(--light-blue);
            transform: scale(1.1);
        }

        .admin-button::after {
            content: 'Ctrl+Shift+A';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 0.7rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .admin-button:hover::after {
            opacity: 1;
        }

        .admin-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px); /* For Safari */
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            overscroll-behavior: contain; /* Prevent scrolling the body behind the modal */
            touch-action: none; /* Prevent default touch actions */
        }

        .admin-modal.visible {
            opacity: 1;
        }

        .admin-content {
            background: rgba(26, 26, 26, 0.95);
            border: 2px solid var(--light-blue);
            border-radius: 20px;
            padding: 30px 20px; /* Reduced horizontal padding for mobile */
            width: 95%; /* Wider on mobile */
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            box-shadow: 0 0 50px rgba(0, 51, 102, 0.5);
            transform: translateY(20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        @media (max-width: 480px) {
            .admin-content {
                padding: 20px 15px;
                width: 98%;
                border-radius: 15px;
            }
        }

        .admin-modal.visible .admin-content {
            transform: translateY(0);
            opacity: 1;
        }

        /* Scrollbar styling for admin content */
        .admin-content::-webkit-scrollbar {
            width: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        .admin-content::-webkit-scrollbar-thumb {
            background: var(--light-blue);
            border-radius: 4px;
        }

        .admin-content::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }

        .admin-header {
            position: sticky;
            top: -30px; /* Matches the padding of admin-content */
            background: rgba(26, 26, 26, 0.98);
            margin: -30px -20px 0 -20px; /* Match the horizontal padding of admin-content */
            padding: 30px 20px 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 10;
        }

        @media (max-width: 480px) {
            .admin-header {
                top: -20px;
                margin: -20px -15px 0 -15px;
                padding: 20px 15px 10px 15px;
            }
        }

        .admin-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .admin-nav-item {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        @media (max-width: 480px) {
            .admin-nav {
                gap: 5px;
            }

            .admin-nav-item {
                padding: 4px 8px;
                font-size: 0.7rem;
                flex: 1;
                min-width: 0;
                white-space: nowrap;
            }
        }

        .admin-nav-item:hover {
            background: var(--light-blue);
        }

        .admin-nav-item.active {
            background: var(--light-blue);
            box-shadow: 0 0 10px rgba(102, 163, 255, 0.3);
        }

        .loading-indicator {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .admin-title {
            font-size: 1.8rem;
            margin: 0 0 10px 0;
            text-align: center;
            background: linear-gradient(45deg, var(--light-blue), var(--neon-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        @media (max-width: 480px) {
            .admin-title {
                font-size: 1.5rem;
            }
        }

        .admin-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding-bottom: 30px; /* Add padding at the bottom for better scrolling */
        }

        @media (max-width: 480px) {
            .admin-form {
                gap: 12px;
                padding-bottom: 20px;
            }
        }

        .admin-input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        @media (max-width: 480px) {
            .admin-input-group {
                gap: 4px;
            }
        }

        .admin-toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .admin-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .admin-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            transition: .4s;
            border-radius: 24px;
            border: 2px solid var(--dark-blue);
        }

        .admin-toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        .admin-toggle input:checked + .admin-toggle-slider {
            background-color: var(--Anemoia);
            border-color: var(--Anemoia-dark);
        }

        .admin-toggle input:checked + .admin-toggle-slider:before {
            transform: translateX(24px);
        }

        .admin-toggle-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .admin-info-text {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-info-text i {
            color: var(--light-blue);
        }

        .admin-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        @media (max-width: 480px) {
            .admin-label {
                font-size: 0.8rem;
            }
        }

        .admin-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--dark-blue);
            border-radius: 10px;
            padding: 12px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
            width: 100%; /* Ensure inputs take full width */
            box-sizing: border-box; /* Include padding in width calculation */
        }

        @media (max-width: 480px) {
            .admin-input {
                padding: 10px;
                font-size: 0.9rem;
            }
        }

        .admin-input:focus {
            outline: none;
            border-color: var(--light-blue);
            box-shadow: 0 0 15px rgba(102, 163, 255, 0.3);
        }

        .admin-select {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--dark-blue);
            border-radius: 10px;
            padding: 12px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
            width: 100%; /* Ensure selects take full width */
            box-sizing: border-box; /* Include padding in width calculation */
        }

        @media (max-width: 480px) {
            .admin-select {
                padding: 10px;
                font-size: 0.9rem;
            }
        }

        .admin-select:focus {
            outline: none;
            border-color: var(--light-blue);
        }

        .admin-button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap; /* Allow wrapping on small screens */
        }

        @media (max-width: 480px) {
            .admin-button-group {
                gap: 8px;
                margin-top: 15px;
            }
        }

        .admin-submit, .admin-cancel {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 0; /* Allow buttons to shrink on mobile */
            white-space: nowrap; /* Prevent text wrapping in buttons */
        }

        @media (max-width: 480px) {
            .admin-submit, .admin-cancel {
                padding: 10px 8px;
                font-size: 0.9rem;
            }
        }

        .admin-submit {
            background: var(--light-blue);
            color: white;
        }

        .admin-submit:hover {
            background: var(--dark-blue);
            transform: translateY(-3px);
        }

        .admin-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .admin-cancel:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .admin-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            display: none;
            word-wrap: break-word; /* Ensure long text wraps properly */
        }

        @media (max-width: 480px) {
            .admin-message {
                padding: 8px;
                font-size: 0.9rem;
            }
        }

        .admin-message.success {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            color: #00ff00;
        }

        .admin-message.error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            color: #ff5555;
        }

        .section-title {
            position: relative;
            padding-bottom: 8px;
            font-size: 1.2rem;
        }

        @media (max-width: 480px) {
            .section-title {
                font-size: 1.1rem;
                padding-bottom: 6px;
            }
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--light-blue), transparent);
        }

        .back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--dark-blue);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
        }

        @media (max-width: 480px) {
            .back-to-top {
                bottom: 15px;
                right: 15px;
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
        }

        .back-to-top.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .back-to-top:hover {
            background: var(--light-blue);
        }

        .back-to-top::after {
            content: 'Back to Top';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 0.7rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .back-to-top:hover::after {
            opacity: 1;
        }

        .version-label {
            position: fixed;
            bottom: 10px;
            left: 10px;
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            z-index: 50;
            pointer-events: none;
            user-select: none;
            transition: color 0.3s ease;
            font-weight: 500;
            letter-spacing: 0.5px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 480px) {
            .version-label {
                font-size: 0.7rem;
                bottom: 5px;
                left: 5px;
            }
        }

        /* Stats page styles */
        .stats-container {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-md);
        }

        .stats-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stats-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stats-content {
            flex: 1;
        }

        .stats-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
        }

        .stats-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        body.light-theme .stats-card {
            background: var(--light-card-bg);
            border-color: var(--light-card-border);
        }

        body.light-theme .stats-icon {
            background: var(--primary);
        }

        body.light-theme .stats-value {
            color: var(--light-text);
        }

        body.light-theme .stats-label {
            color: rgba(0, 0, 0, 0.7);
        }

        body.light-theme .chart-container {
            background: var(--light-card-bg);
            border-color: var(--light-card-border);
        }

        .chart-container {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            height: 300px;
            position: relative;
        }

        /* Activity page styles */
        .activity-timeline {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            transition: transform var(--transition-fast);
        }

        .activity-item:hover {
            transform: translateX(5px);
        }

        .activity-time {
            min-width: 80px;
            text-align: center;
        }

        .activity-date {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 2px;
        }

        .activity-hour {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .activity-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .activity-upgrade .activity-icon {
            background: var(--success);
            color: white;
        }

        .activity-downgrade .activity-icon {
            background: var(--danger);
            color: white;
        }

        .activity-same .activity-icon {
            background: var(--info);
            color: white;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: 5px;
        }

        .activity-player {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .activity-Anemoia {
            color: var(--Anemoia);
            font-size: 0.9rem;
        }

        .activity-details {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .activity-tier-before {
            color: rgba(255, 255, 255, 0.7);
        }

        .activity-arrow {
            color: rgba(255, 255, 255, 0.5);
        }

        .activity-tier-after {
            font-weight: 600;
        }

        .activity-upgrade .activity-tier-after {
            color: var(--success);
        }

        .activity-downgrade .activity-tier-after {
            color: var(--danger);
        }

        .activity-empty, .activity-loading, .xp-leaderboard-loading {
            text-align: center;
            padding: var(--spacing-xl);
            color: rgba(255, 255, 255, 0.5);
            font-style: italic;
        }

        body.light-theme .activity-item {
            background: var(--light-card-bg);
            border-color: var(--light-card-border);
        }

        body.light-theme .activity-date,
        body.light-theme .activity-hour {
            color: rgba(0, 0, 0, 0.6);
        }

        body.light-theme .activity-arrow {
            color: rgba(0, 0, 0, 0.4);
        }

        body.light-theme .activity-tier-before {
            color: rgba(0, 0, 0, 0.7);
        }

        body.light-theme .activity-empty {
            color: rgba(0, 0, 0, 0.5);
        }

        /* Placeholder for future styles */

        /* Guide styles */
        .guides-container {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .guide-section {
            margin-bottom: var(--spacing-xl);
        }

        .guide-section h2 {
            color: var(--primary);
            margin-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: var(--spacing-sm);
        }

        .guide-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
        }

        .guide-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .guide-card h3 {
            color: var(--primary-light);
            margin-top: 0;
            margin-bottom: var(--spacing-md);
        }

        .command-group {
            margin-bottom: var(--spacing-md);
        }

        .command-group h4 {
            color: var(--secondary);
            margin-bottom: var(--spacing-sm);
        }

        .command-group ul {
            list-style-type: none;
            padding-left: var(--spacing-md);
        }

        .command-group li {
            margin-bottom: var(--spacing-sm);
            position: relative;
        }

        .command-group li:before {
            content: "•";
            color: var(--accent);
            position: absolute;
            left: -15px;
        }

        .command-group code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
            color: var(--light-blue);
        }

        /* Discord page styles */
        .discord-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-xl);
            padding: var(--spacing-lg);
        }

        .discord-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            max-width: 800px;
            width: 100%;
            text-align: center;
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .discord-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .discord-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #5865F2, #7289DA);
        }

        .discord-logo {
            font-size: 5rem;
            color: #5865F2;
            margin-bottom: var(--spacing-md);
        }

        .discord-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            color: #FFFFFF;
        }

        .discord-description {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: var(--spacing-lg);
            color: rgba(255, 255, 255, 0.8);
        }

        .discord-button {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            background: #5865F2;
            color: white;
            border: none;
            border-radius: var(--radius-md);
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
        }

        .discord-button:hover {
            background: #4752C4;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(88, 101, 242, 0.4);
        }

        .discord-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-lg);
            text-align: left;
        }

        .discord-feature {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            padding: var(--spacing-md);
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--radius-md);
            transition: transform var(--transition-fast);
        }

        .discord-feature:hover {
            transform: translateY(-3px);
        }

        .discord-feature-icon {
            font-size: 2rem;
            color: #5865F2;
            margin-bottom: var(--spacing-sm);
        }

        .discord-feature-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .discord-feature-text {
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.5;
        }

        body.light-theme .discord-card {
            background: var(--light-card-bg);
            border-color: var(--light-card-border);
        }

        body.light-theme .discord-title {
            color: var(--light-text);
        }

        body.light-theme .discord-description {
            color: rgba(0, 0, 0, 0.7);
        }

        body.light-theme .discord-feature {
            background: rgba(0, 0, 0, 0.05);
        }

        body.light-theme .discord-feature-text {
            color: rgba(0, 0, 0, 0.6);
        }

        /* TOS styles */
        .tos-container, .privacy-container {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .tos-section, .privacy-section {
            margin-bottom: var(--spacing-xl);
        }

        .tos-section h2, .privacy-section h2 {
            color: var(--primary);
            margin-bottom: var(--spacing-sm);
        }

        .tos-section > p, .privacy-section > p {
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
            margin-bottom: var(--spacing-lg);
        }

        body.light-theme .tos-section > p,
        body.light-theme .privacy-section > p {
            color: rgba(0, 0, 0, 0.7);
        }

        .tos-card, .privacy-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        .tos-card h3, .privacy-card h3 {
            color: var(--primary-light);
            margin-top: 0;
            margin-bottom: var(--spacing-sm);
        }

        .tos-card p, .privacy-card p {
            line-height: 1.6;
            margin-bottom: var(--spacing-sm);
        }

        .tos-card ul, .privacy-card ul {
            padding-left: 20px;
            margin-bottom: var(--spacing-sm);
        }

        .tos-card li, .privacy-card li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div id="particleCanvas"></div>
    <div class="version-label">v2.0 (Dashboard)</div>

    <div class="app-container">
        <!-- Sidebar Navigation -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-trophy"></i> No-Co
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-title">Dashboard</div>
                <ul class="nav-items">
                    <li class="nav-item active" data-page="leaderboard">
                        <i class="fas fa-medal"></i>
                        <span class="nav-item-text">Classifica</span>
                    </li>
                    <li class="nav-item" data-page="stats">
                        <i class="fas fa-chart-line"></i>
                        <span class="nav-item-text">Statistiche</span>
                    </li>
                    <li class="nav-item" data-page="activity">
                        <i class="fas fa-history"></i>
                        <span class="nav-item-text">Attività Recenti</span>
                    </li>
                </ul>
            </div>

            <div class="nav-section">
                <div class="nav-title">Community</div>
                <ul class="nav-items">
                    <li class="nav-item" data-page="events">
                        <i class="fas fa-calendar-alt"></i>
                        <span class="nav-item-text">Eventi</span>
                    </li>
                    <li class="nav-item" data-page="guides">
                        <i class="fas fa-book"></i>
                        <span class="nav-item-text">Guide</span>
                    </li>
                    <li class="nav-item" data-page="tos">
                        <i class="fas fa-file-contract"></i>
                        <span class="nav-item-text">Termini di Servizio</span>
                    </li>
                    <li class="nav-item" data-page="privacy">
                        <i class="fas fa-shield-alt"></i>
                        <span class="nav-item-text">Privacy Policy</span>
                    </li>
                </ul>
            </div>

            <div class="nav-section">
                <div class="nav-title">Risorse</div>
                <ul class="nav-items">
                    <li class="nav-item" data-page="guides">
                        <i class="fas fa-book"></i>
                        <span class="nav-item-text">Guide</span>
                    </li>
                    <li class="nav-item" data-page="discord">
                        <i class="fab fa-discord"></i>
                        <span class="nav-item-text">Discord</span>
                    </li>
                </ul>
            </div>

            <div class="sidebar-footer">
                <div class="theme-toggle" id="themeToggle">
                    <i class="fas fa-moon"></i>
                    <span>Tema Scuro</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="container">
                <!-- Leaderboard Page (default) -->
                <div class="page-content" id="page-leaderboard">
                    <div class="header-squircle">
                        <div class="header-title">🏆 Classifica Tier</div>

                        <div class="filter-buttons">
                            <button class="filter-button active" id="filterAll">
                                <i class="fas fa-users"></i> Tutti
                            </button>
                            <button class="filter-button Anemoia" id="filterAnemoia">
                                <i class="fas fa-crown"></i> Anemoia
                            </button>
                        </div>

                        <div class="search-container">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" placeholder="Cerca giocatore..." id="searchInput">
                        </div>

                        <!-- Mobile search toggle and container -->
                        <div class="search-toggle" id="searchToggle">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>

                    <div class="mobile-search-container" id="mobileSearchContainer">
                        <div class="search-container" style="width: 100%;">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" style="width: 100%;" placeholder="Cerca giocatore..." id="mobileSearchInput">
                        </div>
                    </div>

                    <div class="tiers-grid" id="tiersContainer"></div>
                </div>

                <!-- Stats Page -->
                <div class="page-content" id="page-stats" style="display: none;">
                    <div class="header-squircle">
                        <div class="header-title">📊 Statistiche</div>
                    </div>

                    <div class="stats-container">
                        <div class="stats-row">
                            <div class="stats-card">
                                <div class="stats-icon"><i class="fas fa-users"></i></div>
                                <div class="stats-content">
                                    <div class="stats-value" id="totalPlayersCount">0</div>
                                    <div class="stats-label">Giocatori Totali</div>
                                </div>
                            </div>

                            <div class="stats-card">
                                <div class="stats-icon"><i class="fas fa-crown"></i></div>
                                <div class="stats-content">
                                    <div class="stats-value" id="AnemoiaCount">0</div>
                                    <div class="stats-label">Anemoia</div>
                                </div>
                            </div>

                            <div class="stats-card">
                                <div class="stats-icon"><i class="fas fa-calendar-check"></i></div>
                                <div class="stats-content">
                                    <div class="stats-value" id="testsThisMonth">0</div>
                                    <div class="stats-label">Test Questo Mese</div>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>

                <!-- Activity Page -->
                <div class="page-content" id="page-activity" style="display: none;">
                    <div class="header-squircle">
                        <div class="header-title">📝 Attività Recenti</div>
                    </div>

                    <div class="activity-container" id="activityContainer">
                        <div class="activity-loading">Caricamento attività recenti...</div>
                    </div>
                </div>

                <!-- Guides Page -->
                <div class="page-content" id="page-guides" style="display: none;">
                    <div class="header-squircle">
                        <div class="header-title">📚 Guide</div>
                    </div>

                    <div class="guides-container">
                        <div class="guide-section">
                            <h2>Comandi Discord</h2>
                            <p>Ecco una lista completa di tutti i comandi disponibili sul server Discord No-Co.</p>

                            <div class="guide-card">
                                <h3>🎮 Comandi Utente</h3>
                                <div class="command-group">
                                    <h4>Utilità</h4>
                                    <ul>
                                        <li><code>!userinfo [@utente]</code> - Mostra informazioni su un utente</li>
                                        <li><code>!serverinfo</code> - Mostra informazioni sul server</li>
                                        <li><code>!ping</code> - Verifica la latenza del bot</li>
                                        <li><code>!poll [domanda]</code> - Crea un sondaggio</li>
                                    </ul>
                                </div>

                                <div class="command-group">
                                    <h4>Divertimento</h4>
                                    <ul>
                                        <li><code>!8ball [domanda]</code> - Chiedi alla palla magica</li>
                                        <li><code>!rps [scelta]</code> - Gioca a sasso, carta, forbice</li>
                                        <li><code>!trivia [categoria]</code> - Inizia un quiz di trivia</li>
                                        <li><code>!coinflip</code> - Lancia una moneta</li>
                                        <li><code>!random [min] [max]</code> - Genera un numero casuale</li>
                                        <li><code>!pi [start/continua/stop/status]</code> - Calcola le cifre di Pi</li>
                                        <li><code>!meme</code> - Mostra un meme casuale</li>
                                        <li><code>!gif [termine]</code> - Cerca una GIF</li>
                                        <li><code>!quote</code> - Mostra una citazione casuale</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="guide-card">
                                <h3>🛡️ Comandi Staff</h3>
                                <div class="command-group">
                                    <h4>Moderazione</h4>
                                    <ul>
                                        <li><code>!kick [@utente] [motivo]</code> - Espelle un utente dal server</li>
                                        <li><code>!ban [@utente] [motivo]</code> - Bandisce un utente dal server</li>
                                        <li><code>!mute [@utente] [durata] [motivo]</code> - Silenzia un utente</li>
                                        <li><code>!warn [@utente] [motivo]</code> - Avvisa un utente</li>
                                        <li><code>!purge [numero]</code> - Elimina un numero specifico di messaggi</li>
                                    </ul>
                                </div>

                                <div class="command-group">
                                    <h4>Utilità</h4>
                                    <ul>
                                        <li><code>!translate [lingua] [testo]</code> - Traduce un testo</li>
                                        <li><code>!help staff</code> - Mostra l'elenco dei comandi staff</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="guide-card">
                                <h3>🏆 Comandi Tier</h3>
                                <div class="command-group">
                                    <h4>Per lo Staff</h4>
                                    <ul>
                                        <li><code>!results [@utente] [ign] [tier-before] [tier-earned] [true/false]</code> - Registra i risultati di un test tier</li>
                                        <li>Esempio: <code>!results @User Steve Unranked HT3 true</code></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="guide-section">
                            <h2>Sistema Tier</h2>
                            <p>Il sistema Tier è utilizzato per classificare i giocatori in base alle loro abilità.</p>

                            <div class="guide-card">
                                <h3>Livelli Tier</h3>
                                <ul>
                                    <li><strong>Tier 1</strong>: HT1 (High Tier 1) e LT1 (Low Tier 1) - Livello più alto</li>
                                    <li><strong>Tier 2</strong>: HT2 (High Tier 2) e LT2 (Low Tier 2)</li>
                                    <li><strong>Tier 3</strong>: HT3 (High Tier 3) e LT3 (Low Tier 3)</li>
                                    <li><strong>Tier 4</strong>: HT4 (High Tier 4) e LT4 (Low Tier 4)</li>
                                    <li><strong>Tier 5</strong>: HT5 (High Tier 5) e LT5 (Low Tier 5) - Livello più basso</li>
                                </ul>
                            </div>

                            <div class="guide-card">
                                <h3>Anemoia</h3>
                                <p>Anemoia è un riconoscimento speciale assegnato ai giocatori che dimostrano abilità eccezionali o contributi significativi alla community.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Terms of Service Page -->
                <div class="page-content" id="page-tos" style="display: none;">
                    <div class="header-squircle">
                        <div class="header-title">📜 Termini di Servizio</div>
                    </div>

                    <div class="tos-container">
                        <div class="tos-section">
                            <h2>Termini di Servizio di No-Co</h2>
                            <p>Ultimo aggiornamento: 3 Marzo 2025</p>

                            <div class="tos-card">
                                <h3>1. Accettazione dei Termini</h3>
                                <p>Utilizzando il servizio No-Co, accetti di essere vincolato da questi Termini di Servizio. Se non accetti questi termini, ti preghiamo di non utilizzare il nostro servizio.</p>
                            </div>

                            <div class="tos-card">
                                <h3>2. Descrizione del Servizio</h3>
                                <p>No-Co fornisce una piattaforma per la classificazione e il monitoraggio delle abilità dei giocatori di Minecraft, in particolare per il server CoralMC. Il servizio include una dashboard web e un bot Discord per la gestione delle classifiche e delle statistiche.</p>
                            </div>

                            <div class="tos-card">
                                <h3>3. Registrazione e Account</h3>
                                <p>Per utilizzare alcune funzionalità del servizio, potrebbe essere necessario registrarsi o fornire informazioni personali come il tuo nome utente Minecraft. Ti impegni a fornire informazioni accurate e a mantenerle aggiornate.</p>
                            </div>

                            <div class="tos-card">
                                <h3>4. Condotta dell'Utente</h3>
                                <p>Utilizzando il nostro servizio, accetti di non:</p>
                                <ul>
                                    <li>Violare leggi o regolamenti applicabili</li>
                                    <li>Pubblicare contenuti offensivi, diffamatori o inappropriati</li>
                                    <li>Impersonare altre persone o entità</li>
                                    <li>Tentare di accedere a parti del servizio a cui non sei autorizzato</li>
                                    <li>Interferire con il funzionamento del servizio</li>
                                </ul>
                            </div>

                            <div class="tos-card">
                                <h3>5. Proprietà Intellettuale</h3>
                                <p>Tutti i contenuti presenti sul servizio No-Co, inclusi testi, grafica, logo, icone e software, sono di proprietà di No-Co o dei suoi licenzianti e sono protetti dalle leggi sulla proprietà intellettuale.</p>
                            </div>

                            <div class="tos-card">
                                <h3>6. Limitazione di Responsabilità</h3>
                                <p>No-Co fornisce il servizio "così com'è" e "come disponibile" senza garanzie di alcun tipo. Non saremo responsabili per danni diretti, indiretti, incidentali, speciali o consequenziali derivanti dall'uso del servizio.</p>
                            </div>

                            <div class="tos-card">
                                <h3>7. Modifiche ai Termini</h3>
                                <p>Ci riserviamo il diritto di modificare questi termini in qualsiasi momento. Le modifiche saranno effettive immediatamente dopo la pubblicazione dei termini aggiornati. L'uso continuato del servizio dopo tali modifiche costituisce l'accettazione dei nuovi termini.</p>
                            </div>

                            <div class="tos-card">
                                <h3>8. Risoluzione</h3>
                                <p>Ci riserviamo il diritto di terminare o sospendere l'accesso al nostro servizio immediatamente, senza preavviso, per comportamenti che riteniamo violino questi Termini di Servizio.</p>
                            </div>

                            <div class="tos-card">
                                <h3>9. Legge Applicabile</h3>
                                <p>Questi Termini saranno regolati e interpretati in conformità con le leggi italiane, senza riguardo ai suoi conflitti di principi di legge.</p>
                            </div>

                            <div class="tos-card">
                                <h3>10. Contatti</h3>
                                <p>Per domande sui Termini di Servizio, contattaci tramite il server Discord No-Co.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Privacy Policy Page -->
                <div class="page-content" id="page-privacy" style="display: none;">
                    <div class="header-squircle">
                        <div class="header-title">🔒 Privacy Policy</div>
                    </div>

                    <div class="privacy-container">
                        <div class="privacy-section">
                            <h2>Privacy Policy di No-Co</h2>
                            <p>Ultimo aggiornamento: 3 Marzo 2025</p>

                            <div class="privacy-card">
                                <h3>1. Introduzione</h3>
                                <p>La presente Privacy Policy descrive come No-Co raccoglie, utilizza e condivide le informazioni personali quando utilizzi il nostro servizio, che include la dashboard web e il bot Discord.</p>
                            </div>

                            <div class="privacy-card">
                                <h3>2. Informazioni che Raccogliamo</h3>
                                <p>Raccogliamo i seguenti tipi di informazioni:</p>
                                <ul>
                                    <li><strong>Informazioni di Account</strong>: Nome utente Minecraft (IGN), ID Discord, e ruoli sul server Discord.</li>
                                    <li><strong>Dati di Utilizzo</strong>: Informazioni su come interagisci con il nostro servizio, inclusi i comandi utilizzati e le pagine visitate.</li>
                                    <li><strong>Dati di Prestazione</strong>: Tier assegnati, risultati dei test, e altre metriche relative alle tue abilità di gioco.</li>
                                </ul>
                            </div>

                            <div class="privacy-card">
                                <h3>3. Come Utilizziamo le Informazioni</h3>
                                <p>Utilizziamo le informazioni raccolte per:</p>
                                <ul>
                                    <li>Fornire, mantenere e migliorare il nostro servizio</li>
                                    <li>Creare e mantenere classifiche e statistiche</li>
                                    <li>Comunicare con te riguardo al servizio</li>
                                    <li>Monitorare l'utilizzo del servizio</li>
                                    <li>Prevenire attività fraudolente o abusive</li>
                                </ul>
                            </div>

                            <div class="privacy-card">
                                <h3>4. Condivisione delle Informazioni</h3>
                                <p>Non vendiamo le tue informazioni personali a terze parti. Tuttavia, possiamo condividere le tue informazioni nelle seguenti circostanze:</p>
                                <ul>
                                    <li>Con il tuo consenso</li>
                                    <li>Per conformarci a obblighi legali</li>
                                    <li>Per proteggere i diritti, la proprietà o la sicurezza di No-Co, dei nostri utenti o del pubblico</li>
                                </ul>
                            </div>

                            <div class="privacy-card">
                                <h3>5. Sicurezza dei Dati</h3>
                                <p>Adottiamo misure ragionevoli per proteggere le tue informazioni personali da accessi non autorizzati, alterazioni, divulgazioni o distruzioni.</p>
                            </div>

                            <div class="privacy-card">
                                <h3>6. I Tuoi Diritti</h3>
                                <p>Hai il diritto di:</p>
                                <ul>
                                    <li>Accedere alle tue informazioni personali</li>
                                    <li>Correggere informazioni inesatte</li>
                                    <li>Richiedere la cancellazione delle tue informazioni</li>
                                    <li>Opporti al trattamento delle tue informazioni</li>
                                    <li>Richiedere la limitazione del trattamento delle tue informazioni</li>
                                </ul>
                            </div>

                            <div class="privacy-card">
                                <h3>7. Modifiche alla Privacy Policy</h3>
                                <p>Possiamo aggiornare la nostra Privacy Policy di tanto in tanto. Ti informeremo di eventuali modifiche pubblicando la nuova Privacy Policy su questa pagina.</p>
                            </div>

                            <div class="privacy-card">
                                <h3>8. Contatti</h3>
                                <p>Per domande sulla nostra Privacy Policy, contattaci tramite il server Discord No-Co.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Discord Page -->
                <div class="page-content" id="page-discord" style="display: none;">
                    <div class="header-squircle">
                        <div class="header-title"><i class="fab fa-discord"></i> Discord Community</div>
                    </div>

                    <div class="discord-container">
                        <div class="discord-card">
                            <i class="fab fa-discord discord-logo"></i>
                            <h2 class="discord-title">Unisciti alla Nostra Community Discord</h2>
                            <p class="discord-description">
                                Entra nel server Discord ufficiale di No-Co per connetterti con altri giocatori,
                                partecipare a eventi esclusivi, ricevere supporto e rimanere aggiornato sulle ultime novità!
                            </p>
                            <a href="https://dsc.gg/noco-community" target="_blank" class="discord-button">
                                <i class="fas fa-sign-in-alt"></i> Unisciti Ora
                            </a>

                            <div class="discord-features">
                                <div class="discord-feature">
                                    <i class="fas fa-users discord-feature-icon"></i>
                                    <h3 class="discord-feature-title">Community Attiva</h3>
                                    <p class="discord-feature-text">
                                        Connettiti con centinaia di giocatori appassionati e condividi la tua esperienza di gioco.
                                    </p>
                                </div>

                                <div class="discord-feature">
                                    <i class="fas fa-trophy discord-feature-icon"></i>
                                    <h3 class="discord-feature-title">Test Tier</h3>
                                    <p class="discord-feature-text">
                                        Partecipa ai test tier per misurare le tue abilità e ottenere un riconoscimento ufficiale.
                                    </p>
                                </div>

                                <div class="discord-feature">
                                    <i class="fas fa-calendar-alt discord-feature-icon"></i>
                                    <h3 class="discord-feature-title">Eventi Esclusivi</h3>
                                    <p class="discord-feature-text">
                                        Partecipa a tornei, sfide e eventi speciali organizzati regolarmente dal nostro staff.
                                    </p>
                                </div>

                                <div class="discord-feature">
                                    <i class="fas fa-headset discord-feature-icon"></i>
                                    <h3 class="discord-feature-title">Supporto Dedicato</h3>
                                    <p class="discord-feature-text">
                                        Ricevi assistenza diretta dal nostro team di moderatori e amministratori.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other pages would be added here -->
            </div>
        </div>
    </div>

    <!-- Mobile sidebar toggle button -->
    <button class="sidebar-toggle" id="sidebarToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Admin Button (hidden by default) -->
    <div class="admin-button" id="adminButton" style="display: none;">⚙️</div>

    <div class="profile-modal" id="profileModal">
        <div class="profile-content" id="profileContent">
            <button class="close-button" id="closeButton">&times;</button>
            <div class="profile-image-container">
                <img class="profile-image" id="profileImage" src="" alt="Profile Image">
                <div class="tier-squircle">
                    <div class="tier-squircle-content">
                        <div class="tier-emoji-large" id="profileTierEmoji"></div>
                    </div>
                </div>
                <div id="AnemoiaBadge" class="Anemoia-badge">
                    <i class="fas fa-crown"></i> Anemoia
                </div>
            </div>
            <div class="profile-info">
                <h2 class="profile-ign" id="profileIGN"></h2>
                <div class="profile-divider"></div>
                <div class="tier-info">
                    <div class="tier-row">
                        <div class="tier-label">Tier Attuale:</div>
                        <div class="tier-text" id="profileTierText"></div>
                    </div>
                    <div class="tier-row">
                        <div class="tier-label">Tier Precedente:</div>
                        <div class="tier-text" id="profilePrevTier"></div>
                    </div>
                    <div class="tier-row">
                        <div class="tier-label">Data Test:</div>
                        <div class="tier-text" id="profileDate"></div>
                    </div>
                    <div class="tier-row">
                        <div class="tier-label">Statistiche:</div>
                        <div class="tier-text">
                            <a id="profileCoralMCLink" href="#" target="_blank" class="coral-link">
                                <i class="fas fa-external-link-alt"></i> CoralMC Stats
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Modal -->
    <div class="admin-modal" id="adminModal">
        <div class="admin-content" id="adminContent">
            <div class="back-to-top" id="backToTop">↑</div>
            <div class="admin-header">
                <h2 class="admin-title">Admin Panel</h2>
                <div class="admin-nav">
                    <button class="admin-nav-item" onclick="document.getElementById('player-management').scrollIntoView({behavior: 'smooth'})">Player Management</button>
                    <button class="admin-nav-item" onclick="document.getElementById('data-management').scrollIntoView({behavior: 'smooth'})">Data Management</button>
                    <button class="admin-nav-item" onclick="document.getElementById('github-integration').scrollIntoView({behavior: 'smooth'})">GitHub Integration</button>
                </div>
            </div>
            <div class="admin-form">
                <h3 id="player-management" class="section-title" style="color: var(--light-blue); margin: 0 0 15px 0;">Player Management</h3>

                <div class="admin-input-group">
                    <label class="admin-label" for="adminIgn">IGN (Minecraft Username)</label>
                    <input type="text" id="adminIgn" class="admin-input" placeholder="Enter IGN...">
                </div>
                <div class="admin-input-group">
                    <label class="admin-label" for="adminTier">Tier</label>
                    <select id="adminTier" class="admin-select">
                        <option value="">Select Tier...</option>
                        <option value="HT1">HT1</option>
                        <option value="LT1">LT1</option>
                        <option value="HT2">HT2</option>
                        <option value="LT2">LT2</option>
                        <option value="HT3">HT3</option>
                        <option value="LT3">LT3</option>
                        <option value="HT4">HT4</option>
                        <option value="LT4">LT4</option>
                        <option value="HT5">HT5</option>
                        <option value="LT5">LT5</option>
                    </select>
                </div>
                <div class="admin-input-group">
                    <label class="admin-label">Anemoia</label>
                    <div class="admin-toggle-container">
                        <label class="admin-toggle">
                            <input type="checkbox" id="adminAnemoia">
                            <span class="admin-toggle-slider"></span>
                        </label>
                        <span class="admin-toggle-label">Giocatore Anemoia</span>
                    </div>
                </div>



                <div class="admin-button-group">
                    <button class="admin-submit" id="adminSubmit">Save</button>
                    <button class="admin-cancel" id="adminCancel">Cancel</button>
                </div>
                <div class="admin-message" id="adminMessage"></div>

                <div class="profile-divider" style="margin: 30px 0 20px;"></div>

                <h3 id="data-management" class="section-title" style="color: var(--light-blue); margin-bottom: 15px;">Data Management</h3>

                <div class="admin-button-group">
                    <button class="admin-submit" id="exportData" style="background: var(--dark-blue);">Export Data</button>
                    <button class="admin-submit" id="importData" style="background: var(--dark-blue);">Import Data</button>
                </div>

                <div style="display: none;">
                    <input type="file" id="fileInput" accept=".json">
                </div>

                <div class="admin-button-group" style="margin-top: 10px;">
                    <button class="admin-submit" id="clearData" style="background: #aa3333;">Reset All Data</button>
                </div>

                <div class="admin-button-group" style="margin-top: 10px;">
                    <button class="admin-submit" id="debugData" style="background: #555;">Debug Data</button>
                </div>

                <div class="profile-divider" style="margin: 30px 0 20px;"></div>

                <h3 id="github-integration" class="section-title" style="color: var(--light-blue); margin-bottom: 15px;">GitHub Integration</h3>

                <div class="admin-input-group">
                    <label class="admin-label" for="githubToken">GitHub Personal Access Token</label>
                    <input type="password" id="githubToken" class="admin-input" placeholder="Enter your GitHub token...">
                </div>

                <div class="admin-input-group">
                    <label class="admin-label" for="githubUsername">GitHub Username</label>
                    <input type="text" id="githubUsername" class="admin-input" placeholder="Enter your GitHub username...">
                </div>

                <div class="admin-input-group">
                    <label class="admin-label" for="githubRepo">Repository Name</label>
                    <input type="text" id="githubRepo" class="admin-input" placeholder="Enter repository name...">
                </div>

                <div class="admin-button-group">
                    <button class="admin-submit" id="saveGitHubSettings" style="background: var(--dark-blue);">
                        <span class="desktop-text">Save GitHub Settings</span>
                        <span class="mobile-text" style="display: none;">Save Settings</span>
                    </button>
                    <button class="admin-submit" id="clearGitHubSettings" style="background: #aa3333;">
                        <span class="desktop-text">Clear GitHub Settings</span>
                        <span class="mobile-text" style="display: none;">Clear Settings</span>
                    </button>
                </div>

                <div class="admin-button-group" style="margin-top: 10px;">
                    <button class="admin-submit" id="pushToGitHub" style="background: #4CAF50;">
                        <span class="desktop-text">Push Current Data to GitHub</span>
                        <span class="mobile-text" style="display: none;">Push to GitHub</span>
                    </button>
                </div>

                <style>
                    @media (max-width: 480px) {
                        .desktop-text {
                            display: none;
                        }
                        .mobile-text {
                            display: inline !important;
                        }
                    }
                </style>

                <div class="admin-button-group" style="margin-top: 10px;">
                    <button class="admin-submit" id="checkDataJson" style="background: #FF9800;">Check data.json</button>
                    <button class="admin-submit" id="createDataJson" style="background: #2196F3;">Create data.json</button>
                </div>

                <div class="admin-button-group" style="margin-top: 10px;">
                    <button class="admin-submit" id="openGitHubRepo" style="background: #333;">Open GitHub Repository</button>
                    <button class="admin-submit" id="viewDataJson" style="background: #333;">View data.json</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        // Detect if the device is likely mobile or low-powered
        const isMobileOrLowPower = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                                  window.navigator.hardwareConcurrency <= 4;

        // Configure particles.js with heavily optimized settings for performance
        particlesJS('particleCanvas', {
            particles: {
                number: {
                    value: 30, // Drastically reduced particle count
                    density: { enable: true, value_area: 1000 }
                },
                color: { value: "#ffffff" },
                shape: {
                    type: "circle",
                    stroke: { width: 0, color: "#000000" },
                },
                opacity: {
                    value: 0.2,
                    random: false,
                    anim: { enable: false }
                },
                size: {
                    value: 2,
                    random: false, // Disable random sizing for better performance
                    anim: { enable: false }
                },
                line_linked: {
                    enable: true,
                    distance: 100,
                    color: "#ffffff",
                    opacity: 0.1, // Reduced opacity
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 1, // Slower movement
                    direction: "none",
                    random: false,
                    straight: false,
                    out_mode: "out",
                    bounce: false,
                    attract: { enable: false }
                }
            },
            interactivity: {
                detect_on: "canvas",
                events: {
                    onhover: { enable: false }, // Disabled hover effects
                    onclick: { enable: false }, // Disabled click effects
                    resize: true
                },
                modes: {
                    repulse: { distance: 0, duration: 0 },
                    push: { particles_nb: 0 }
                }
            },
            retina_detect: false // Disable retina detection for better performance
        });

        const tierEmojis = {1: "🥇", 2: "🥈", 3: "🥉", 4: "🔷", 5: "🔶"};
        let allPlayers = [];
        let currentFilter = 'all'; // 'all' or 'Anemoia'
        const tierOptions = ['HT1', 'LT1', 'HT2', 'LT2', 'HT3', 'LT3', 'HT4', 'LT4', 'HT5', 'LT5'];

        async function getUUID(username) {
            try {
                const response = await fetch(`https://api.mojang.com/users/profiles/minecraft/${username}`);
                if (!response.ok) {
                    // Generate a random UUID instead of failing
                    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                        return v.toString(16);
                    });
                }
                const data = await response.json();
                return data.id;
            } catch (error) {
                console.error("Errore nel recupero dell'UUID:", error);
                // Generate a random UUID on error
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }
        }

        const tiersContainer = document.getElementById('tiersContainer');
        for (let tier = 1; tier <= 5; tier++) {
            const card = document.createElement('div');
            card.className = 'tier-card';
            card.innerHTML = `
                <div class="tier-header">
                    <span class="tier-emoji">${tierEmojis[tier]}</span>
                    <span class="tier-number">TIER ${tier}</span>
                </div>
                <div class="user-list" id="tier-${tier}-users"></div>
            `;
            tiersContainer.appendChild(card);
        }

        // Admin functionality
        const adminButton = document.getElementById('adminButton');
        const adminModal = document.getElementById('adminModal');
        const adminIgnInput = document.getElementById('adminIgn');
        const adminTierSelect = document.getElementById('adminTier');
        const adminSubmit = document.getElementById('adminSubmit');
        const adminCancel = document.getElementById('adminCancel');
        const adminMessage = document.getElementById('adminMessage');

        // Admin button click event is now handled below with GitHub settings loading

        function closeAdminModal() {
            adminModal.classList.remove('visible');
            setTimeout(() => {
                adminModal.style.display = 'none';
            }, 300); // Match the transition duration
        }

        adminCancel.addEventListener('click', closeAdminModal);

        adminModal.addEventListener('click', (e) => {
            if (e.target === adminModal) {
                closeAdminModal();
            }
        });

        function clearAdminForm() {
            adminIgnInput.value = '';
            adminTierSelect.value = '';
            document.getElementById('adminAnemoia').checked = false;

            adminMessage.style.display = 'none';
            adminMessage.textContent = '';
            adminMessage.className = 'admin-message';
        }

        function showAdminMessage(message, isError = false) {
            adminMessage.textContent = message;
            adminMessage.className = `admin-message ${isError ? 'error' : 'success'}`;
            adminMessage.style.display = 'block';
        }

        adminIgnInput.addEventListener('input', async () => {
            const ign = adminIgnInput.value.trim();
            if (ign) {
                const existingPlayer = allPlayers.find(p => p.ign.toLowerCase() === ign.toLowerCase());
                if (existingPlayer) {
                    adminTierSelect.value = existingPlayer.tier_earned || '';
                    document.getElementById('adminAnemoia').checked = existingPlayer.Anemoia || false;
                }
            }
        });

        adminSubmit.addEventListener('click', async () => {
            const ign = adminIgnInput.value.trim();
            const tier = adminTierSelect.value;
            const Anemoia = document.getElementById('adminAnemoia').checked;

            if (!ign) {
                showAdminMessage('Inserisci un IGN', true);
                return;
            }

            if (!tier) {
                showAdminMessage('Seleziona un tier', true);
                return;
            }

            try {
                // Check if player exists
                const existingPlayerIndex = allPlayers.findIndex(p => p.ign.toLowerCase() === ign.toLowerCase());
                // Get UUID (will generate a random one if lookup fails)
                const uuid = await getUUID(ign);

                const timestamp = new Date().toISOString();
                if (existingPlayerIndex !== -1) {
                    // Update existing player
                    const tierBefore = allPlayers[existingPlayerIndex].tier_earned;
                    allPlayers[existingPlayerIndex] = {
                        tier_before: tierBefore,
                        tier_earned: tier,
                        ign: ign,
                        timestamp: timestamp,
                        uuid: uuid,
                        Anemoia: Anemoia
                    };
                    showAdminMessage(`Giocatore aggiornato: ${ign}${Anemoia ? ' (Anemoia)' : ''}`);
                } else {
                    // Add new player
                    allPlayers.push({
                        tier_before: "Nessuno",
                        tier_earned: tier,
                        ign: ign,
                        timestamp: timestamp,
                        uuid: uuid,
                        Anemoia: Anemoia
                    });
                    showAdminMessage(`Nuovo giocatore: ${ign}${Anemoia ? ' (Anemoia)' : ''}`);
                }

                // Always save to GitHub repository
                await saveToGitHub(allPlayers);

                updateUI();

                // Clear form after successful save
                setTimeout(() => {
                    clearAdminForm();
                    closeAdminModal();
                }, 2000);

            } catch (error) {
                console.error("Error saving data:", error);
                showAdminMessage('Errore nel salvare i dati', true);
            }
        });

        async function saveToGitHub(data) {
            try {
                // Show loading message with spinner
                adminMessage.innerHTML = 'Saving to GitHub... <span class="loading-indicator"></span>';
                adminMessage.className = 'admin-message success';
                adminMessage.style.display = 'block';

                // Get the token and settings from localStorage
                const token = localStorage.getItem('github_token');
                const owner = localStorage.getItem('github_username');
                const repo = localStorage.getItem('github_repo');

                console.log('GitHub Settings:', {
                    owner,
                    repo,
                    tokenProvided: !!token,
                    tokenLength: token ? token.length : 0
                });

                if (!token || !owner || !repo) {
                    throw new Error('GitHub settings are incomplete. Please configure them in the admin panel.');
                }

                const path = 'data.json'; // Path to data.json in your repository

                // First, get the current file to get its SHA
                const getUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
                console.log('Fetching file from:', getUrl);

                const getResponse = await fetch(getUrl, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                console.log('Get file response status:', getResponse.status);

                let sha = null;

                if (getResponse.status === 404) {
                    // File doesn't exist, we'll create it
                    console.log('data.json file not found, will create a new one');
                } else if (!getResponse.ok) {
                    const errorText = await getResponse.text();
                    console.error('GitHub API error response:', errorText);
                    throw new Error(`Failed to get file: ${getResponse.status} ${getResponse.statusText}`);
                } else {
                    // File exists, get its SHA
                    const fileInfo = await getResponse.json();
                    sha = fileInfo.sha;
                    console.log('Current file SHA:', sha);
                }

                // Helper function to safely encode Unicode strings to base64
                function utf8ToBase64(str) {
                    return btoa(unescape(encodeURIComponent(str)));
                }

                // Sort data by timestamp (newest first)
                data.sort((a, b) => {
                    const dateA = new Date(a.timestamp || 0);
                    const dateB = new Date(b.timestamp || 0);
                    return dateB - dateA;
                });

                // Prepare the content (base64 encoded)
                const jsonData = JSON.stringify(data, null, 2);
                console.log('Data to save (first 100 chars):', jsonData.substring(0, 100) + '...');
                const content = utf8ToBase64(jsonData);

                // Update or create the file
                const updateUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
                console.log('Updating file at:', updateUrl);

                // Prepare the request body
                const updateBodyObj = {
                    message: sha ? 'Update player data via web interface' : 'Create data.json via web interface',
                    content: content
                };

                // Only include sha if the file already exists
                if (sha) {
                    updateBodyObj.sha = sha;
                }

                const updateBody = JSON.stringify(updateBodyObj);
                console.log('Update request body:', updateBodyObj);

                const updateResponse = await fetch(updateUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: updateBody
                });

                console.log('Update response status:', updateResponse.status);

                if (!updateResponse.ok) {
                    const errorText = await updateResponse.text();
                    console.error('GitHub API error response:', errorText);
                    throw new Error(`Failed to update file: ${updateResponse.status} ${updateResponse.statusText}`);
                }

                const result = await updateResponse.json();
                console.log('GitHub update successful:', result);
                showAdminMessage('Successfully saved to GitHub repository!');

                return true;
            } catch (error) {
                console.error('Error saving to GitHub:', error);
                showAdminMessage('Error saving to GitHub: ' + error.message, true);
                return false;
            }
        }

        async function saveData() {
            try {
                // Just show success message
                adminMessage.innerHTML = 'Data saved successfully!';
                adminMessage.className = 'admin-message success';
                adminMessage.style.display = 'block';

                return true;
            } catch (error) {
                console.error("Error saving data:", error);
                throw error;
            }
        }

        // Cache DOM elements for better performance
        const filterAllButton = document.getElementById('filterAll');
        const filterAnemoiaButton = document.getElementById('filterAnemoia');
        const tierLists = {
            1: document.getElementById('tier-1-users'),
            2: document.getElementById('tier-2-users'),
            3: document.getElementById('tier-3-users'),
            4: document.getElementById('tier-4-users'),
            5: document.getElementById('tier-5-users')
        };

        // Cache sorted players to avoid re-sorting when filter changes
        let cachedSortedPlayers = [];
        let lastUpdateTime = 0;

        function updateUI() {
            const now = Date.now();
            // Throttle updates to prevent excessive rendering
            if (now - lastUpdateTime < 100) return;
            lastUpdateTime = now;

            // Create a map to hold fragments for each tier list
            const fragments = {
                1: document.createDocumentFragment(),
                2: document.createDocumentFragment(),
                3: document.createDocumentFragment(),
                4: document.createDocumentFragment(),
                5: document.createDocumentFragment()
            };

            // Clear all lists at once
            Object.values(tierLists).forEach(list => {
                if (list) list.innerHTML = '';
            });

            // Only sort if we don't have cached sorted players
            if (cachedSortedPlayers.length !== allPlayers.length) {
                // Sort players by tier and name for consistent display
                cachedSortedPlayers = [...allPlayers].sort((a, b) => {
                    // First sort by tier number
                    const tierA = a.tier_earned.slice(-1);
                    const tierB = b.tier_earned.slice(-1);
                    if (tierA !== tierB) return tierA - tierB;

                    // Then by HT/LT (HT comes first)
                    const isHTa = a.tier_earned.startsWith('H');
                    const isHTb = b.tier_earned.startsWith('H');
                    if (isHTa !== isHTb) return isHTb ? 1 : -1;

                    // Finally by name
                    return a.ign.localeCompare(b.ign);
                });
            }

            // Filter players based on current filter
            const filteredPlayers = currentFilter === 'all'
                ? cachedSortedPlayers
                : cachedSortedPlayers.filter(player => player.Anemoia === true);

            // Build all elements first and add them to fragments
            // Use a more efficient approach with fewer DOM operations
            const playerTemplate = document.createElement('template');

            filteredPlayers.forEach(entry => {
                const tierNumber = entry.tier_earned.slice(-1);
                if (!fragments[tierNumber]) return;

                // Create HTML string for better performance
                const AnemoiaClass = entry.Anemoia ? ' Anemoia' : '';
                const AnemoiaIndicator = entry.Anemoia
                    ? '<span class="Anemoia-indicator"><i class="fas fa-crown"></i></span>'
                    : '';
                const htClass = entry.tier_earned.startsWith('H') ? ' ht' : '';

                playerTemplate.innerHTML = `
                    <div class="user-item${AnemoiaClass}" data-ign="${entry.ign}">
                        <div class="user-info">
                            <div class="user-name">${entry.ign} ${AnemoiaIndicator}</div>
                            <div class="user-tier">
                                <span class="sword">⚔️</span>
                                <span class="tier-badge${htClass}">${entry.tier_earned}</span>
                            </div>
                        </div>
                    </div>
                `;

                const userDiv = playerTemplate.content.firstElementChild.cloneNode(true);
                userDiv.addEventListener('click', () => showPlayerProfile(entry));
                fragments[tierNumber].appendChild(userDiv);
            });

            // Add all fragments to the DOM at once (minimizes reflows)
            for (let tier = 1; tier <= 5; tier++) {
                const list = tierLists[tier];
                if (list) list.appendChild(fragments[tier]);
            }

            // Update filter button states
            filterAllButton.classList.toggle('active', currentFilter === 'all');
            filterAnemoiaButton.classList.toggle('active', currentFilter === 'Anemoia');

            // Show empty state message if no players in filter
            if (filteredPlayers.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.className = 'empty-state';
                emptyMessage.innerHTML = `
                    <div class="empty-icon"><i class="fas fa-search"></i></div>
                    <div class="empty-text">Nessun giocatore ${currentFilter === 'Anemoia' ? 'Anemoia' : ''} trovato</div>
                `;
                tierLists[1].appendChild(emptyMessage);
            }
        }
        const searchInput = document.getElementById('searchInput');
        const mobileSearchInput = document.getElementById('mobileSearchInput');
        const searchToggle = document.getElementById('searchToggle');
        const mobileSearchContainer = document.getElementById('mobileSearchContainer');

        // Handle search input events
        searchInput.addEventListener('input', debounce(handleSearch, 300));
        mobileSearchInput.addEventListener('input', debounce(handleSearch, 300));

        // Toggle mobile search
        searchToggle.addEventListener('click', function() {
            mobileSearchContainer.style.display = mobileSearchContainer.style.display === 'block' ? 'none' : 'block';

            // Force reflow to ensure transition works
            void mobileSearchContainer.offsetWidth;

            if (mobileSearchContainer.style.display === 'block') {
                mobileSearchContainer.classList.add('active');
                mobileSearchInput.focus();
            } else {
                mobileSearchContainer.classList.remove('active');
            }
        });

        function debounce(func, wait) {
            let timeout;
            return function(event) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.call(this, event), wait);
            };
        }

        // Cache for search results to avoid repeated searches
        const searchCache = new Map();

        async function handleSearch(event) {
            // Get the search term from whichever input triggered the event
            const searchTerm = event.target.value.trim().toLowerCase();
            if (!searchTerm) return;

            // Check cache first
            if (searchCache.has(searchTerm)) {
                const player = searchCache.get(searchTerm);
                if (player) showPlayerProfile(player);
                return;
            }

            // If search term is at least 3 characters, do a more precise search
            if (searchTerm.length >= 3) {
                const player = allPlayers.find(p => p.ign.toLowerCase().includes(searchTerm));

                // Cache the result (including null results)
                searchCache.set(searchTerm, player || null);

                if (player) showPlayerProfile(player);
            }

            // Clear cache when it gets too large
            if (searchCache.size > 100) {
                const keysToDelete = Array.from(searchCache.keys()).slice(0, 50);
                keysToDelete.forEach(key => searchCache.delete(key));
            }
        }

        // Cache DOM elements for profile modal
        const profileModal = document.getElementById('profileModal');
        const profileContent = document.getElementById('profileContent');
        const profileImage = document.getElementById('profileImage');
        const profileIGN = document.getElementById('profileIGN');
        const profileTierEmoji = document.getElementById('profileTierEmoji');
        const profileTierText = document.getElementById('profileTierText');
        const profilePrevTier = document.getElementById('profilePrevTier');
        const profileDate = document.getElementById('profileDate');
        const AnemoiaBadge = document.getElementById('AnemoiaBadge');

        // Add click handler once
        profileModal.addEventListener('click', (e) => {
            if (e.target === profileModal) {
                closeModal();
            }
        });

        function showPlayerProfile(player) {
            // Prepare all content before showing the modal
            const tierNumber = player.tier_earned.replace(/\D/g,'');
            const placeholderImage = 'data:image/svg+xml;charset=utf-8,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 viewBox%3D%220 0 16 9%22%3E%3C%2Fsvg%3E';
            const imageSrc = `https://render.crafty.gg/3d/bust/${player.uuid}`;
            const emojiContent = tierEmojis[tierNumber] || '⚔️';

            // Format date if available
            let formattedDate = 'N/A';
            if (player.timestamp) {
                try {
                    const date = new Date(player.timestamp);
                    formattedDate = date.toLocaleDateString('it-IT', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                } catch (e) {
                    console.error('Error formatting date:', e);
                }
            }

            // Update content
            profileImage.src = placeholderImage; // Set placeholder first
            profileIGN.textContent = player.ign;
            profileTierEmoji.textContent = emojiContent;
            profileTierText.textContent = player.tier_earned;
            profilePrevTier.textContent = player.tier_before || 'Nessuno';
            profileDate.textContent = formattedDate;

            // Set CoralMC stats link
            const coralMCLink = document.getElementById('profileCoralMCLink');
            coralMCLink.href = `https://stats.coralmc.it/user/${player.ign}`;
            coralMCLink.setAttribute('title', `Visualizza le statistiche di ${player.ign} su CoralMC`);

            // Show/hide Anemoia badge
            AnemoiaBadge.style.display = player.Anemoia ? 'flex' : 'none';

            // Show modal first
            profileModal.style.display = 'flex';

            // Force reflow and add active class in next frame
            requestAnimationFrame(() => {
                profileContent.classList.add('active');

                // Load the actual image after modal is shown
                const img = new Image();
                img.onload = () => {
                    profileImage.src = imageSrc;
                };
                img.onerror = () => {
                    // Keep placeholder on error
                };
                img.src = imageSrc;
            });
        }

        function closeModal() {
            const modal = document.getElementById('profileModal');
            const content = document.getElementById('profileContent');
            content.classList.remove('active');
            setTimeout(() => modal.style.display = 'none', 300);
        }

        document.getElementById('closeButton').addEventListener('click', closeModal);

        async function loadData() {
            try {
                // Always load directly from data.json
                console.log("Loading from data.json...");
                const response = await fetch('data.json');

                if (response.ok) {
                    const data = await response.json();
                    console.log("Data loaded from data.json:", data);

                    if (Array.isArray(data) && data.length > 0) {
                        // Add UUIDs if missing
                        for (const player of data) {
                            if (!player.uuid) {
                                player.uuid = await getUUID(player.ign);
                            }
                        }

                        allPlayers = data;
                        updateUI();
                        console.log("Data loaded from data.json:", data.length, "players");
                        return;
                    } else {
                        console.error("Invalid data format in data.json");
                    }
                } else {
                    console.error("Failed to load data.json:", response.status);
                }

                // If data.json failed, load the embedded default data
                console.log("Loading embedded default data...");
                allPlayers = [
                    {
                        "tier_before": "Unranked",
                        "tier_earned": "LT3",
                        "ign": "Giulio_Cesare_",
                        "tester": "987654321098765432",
                        "timestamp": "2023-10-10T12:34:56.789Z"
                    },
                    {
                        "tier_before": "Unranked",
                        "tier_earned": "LT4",
                        "ign": "Diocleziano_",
                        "tester": "876543210987654321",
                        "timestamp": "2023-10-10T13:45:00.000Z"
                    },
                    {
                        "tier_before": "Nessuno",
                        "tier_earned": "LT3",
                        "ign": "Ottaviano_August",
                        "tester": "Faw",
                        "timestamp": "2025-03-05T16:10:00Z"
                    },
                    {
                        "tier_before": "Nessuno",
                        "tier_earned": "HT4",
                        "ign": "3463k",
                        "tester": "Faw",
                        "timestamp": "2025-03-05T16:25:00Z"
                    },
                    {
                        "tier_before": "Nessuno",
                        "tier_earned": "HT2",
                        "ign": "minchiacraft",
                        "tester": "Faw",
                        "timestamp": "2025-03-05T16:30:00Z"
                    },
                    {
                        "tier_before": "Nessuno",
                        "tier_earned": "HT2",
                        "ign": "afterylyfe",
                        "tester": "Faw",
                        "timestamp": "2025-03-05T21:29:00Z"
                    },
                    {
                        "tier_before": "Nessuno",
                        "tier_earned": "LT1",
                        "ign": "go2workk",
                        "tester": "Faw",
                        "timestamp": "2025-03-06T20:45:00Z"
                    },
                    {
                        "tier_before": "Nessuno",
                        "tier_earned": "LT3",
                        "ign": "Takeruluigi",
                        "tester": "Julius Caesar",
                        "timestamp": "2025-03-07T22:11:00Z"
                    },
                    {
                        "tier_before": "Unranked",
                        "tier_earned": "HT2",
                        "ign": "kytsue",
                        "tester": "729405047644880968",
                        "timestamp": "2025-03-08 19:33:31.842327+00:00"
                    },
                    {
                        "tier_before": "LT4",
                        "tier_earned": "HT5",
                        "ign": "ER_GLADIATOR1",
                        "tester": "729405047644880968",
                        "timestamp": "2025-03-08 21:54:24.265105+00:00"
                    }
                ];

                // Add UUIDs
                for (const player of allPlayers) {
                    if (!player.uuid) {
                        player.uuid = await getUUID(player.ign);
                    }
                }

                updateUI();
                console.log("Loaded embedded default data:", allPlayers.length, "players");
            } catch (error) {
                console.error("Critical error loading data:", error);
                // Last resort - show at least something
                allPlayers = [
                    {
                        "tier_earned": "HT2",
                        "ign": "kytsue",
                        "tester": "Admin",
                        "timestamp": new Date().toISOString()
                    }
                ];
                updateUI();
                alert("Error loading data. Please try refreshing the page or contact the administrator.");
            }
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl+Shift+A to show admin button
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                const adminButton = document.getElementById('adminButton');
                adminButton.style.display = adminButton.style.display === 'none' ? 'flex' : 'none';
            }

            // Escape key to close admin modal
            if (e.key === 'Escape' && adminModal.style.display === 'flex') {
                closeAdminModal();
            }
        });

        // GitHub settings management
        // Function to verify GitHub token permissions
        async function verifyGitHubToken(token, username, repo) {
            try {
                console.log('Verifying GitHub token...');

                // First check if we can access the user info
                const userResponse = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!userResponse.ok) {
                    console.error('Failed to verify user with token:', userResponse.status);
                    return { success: false, message: 'Invalid token or insufficient permissions' };
                }

                const userData = await userResponse.json();
                console.log('GitHub user verified:', userData.login);

                // Then check if we can access the repository
                const repoResponse = await fetch(`https://api.github.com/repos/${username}/${repo}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!repoResponse.ok) {
                    console.error('Failed to access repository:', repoResponse.status);
                    return {
                        success: false,
                        message: `Cannot access repository ${username}/${repo}. Make sure it exists and your token has access.`
                    };
                }

                const repoData = await repoResponse.json();
                console.log('Repository access verified:', repoData.full_name);

                // Finally, check if we have write access by attempting to get the contents
                const contentsUrl = `https://api.github.com/repos/${username}/${repo}/contents`;
                console.log('Checking repository contents access:', contentsUrl);

                const contentsResponse = await fetch(contentsUrl, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!contentsResponse.ok) {
                    console.error('Failed to access repository contents:', contentsResponse.status);
                    return {
                        success: false,
                        message: 'Cannot access repository contents. Make sure your token has the "repo" scope.'
                    };
                }

                return {
                    success: true,
                    message: `Successfully verified access to ${username}/${repo}`
                };
            } catch (error) {
                console.error('Error verifying GitHub token:', error);
                return { success: false, message: `Error: ${error.message}` };
            }
        }

        document.getElementById('saveGitHubSettings').addEventListener('click', async function() {
            const token = document.getElementById('githubToken').value.trim();
            const username = document.getElementById('githubUsername').value.trim();
            const repo = document.getElementById('githubRepo').value.trim();

            if (!token || !username || !repo) {
                showAdminMessage('Please fill in all GitHub settings', true);
                return;
            }

            // Show loading message with spinner
            adminMessage.innerHTML = 'Verifying GitHub settings... <span class="loading-indicator"></span>';
            adminMessage.className = 'admin-message success';
            adminMessage.style.display = 'block';

            // Verify the token has necessary permissions
            const verification = await verifyGitHubToken(token, username, repo);

            if (verification.success) {
                localStorage.setItem('github_token', token);
                localStorage.setItem('github_username', username);
                localStorage.setItem('github_repo', repo);

                // Clear the token field for security
                document.getElementById('githubToken').value = '';

                showAdminMessage('GitHub settings saved successfully! ' + verification.message);
            } else {
                showAdminMessage('GitHub settings error: ' + verification.message, true);
            }
        });

        document.getElementById('clearGitHubSettings').addEventListener('click', function() {
            if (confirm('Are you sure you want to clear your GitHub settings?')) {
                localStorage.removeItem('github_token');
                localStorage.removeItem('github_username');
                localStorage.removeItem('github_repo');

                document.getElementById('githubToken').value = '';
                document.getElementById('githubUsername').value = '';
                document.getElementById('githubRepo').value = '';

                showAdminMessage('GitHub settings cleared');
            }
        });

        // Handle Back to Top button
        document.getElementById('backToTop').addEventListener('click', function() {
            document.getElementById('adminContent').scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Show/hide Back to Top button and update active nav item based on scroll position
        document.getElementById('adminContent').addEventListener('scroll', function() {
            const backToTop = document.getElementById('backToTop');
            if (this.scrollTop > 300) {
                backToTop.classList.add('visible');
            } else {
                backToTop.classList.remove('visible');
            }

            // Update active navigation item
            const sections = [
                { id: 'player-management', navIndex: 0 },
                { id: 'data-management', navIndex: 1 },
                { id: 'github-integration', navIndex: 2 }
            ];

            const navItems = document.querySelectorAll('.admin-nav-item');

            // Find which section is currently most visible
            let activeSection = 0;
            let maxVisibility = 0;

            sections.forEach((section, index) => {
                const element = document.getElementById(section.id);
                if (element) {
                    const rect = element.getBoundingClientRect();
                    const adminContentRect = this.getBoundingClientRect();

                    // Calculate how much of the section is visible
                    const visibleTop = Math.max(rect.top, adminContentRect.top);
                    const visibleBottom = Math.min(rect.bottom, adminContentRect.bottom);
                    const visibleHeight = Math.max(0, visibleBottom - visibleTop);

                    if (visibleHeight > maxVisibility) {
                        maxVisibility = visibleHeight;
                        activeSection = section.navIndex;
                    }
                }
            });

            // Update active class
            navItems.forEach((item, index) => {
                if (index === activeSection) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        });

        // Load saved GitHub settings when admin panel opens
        adminButton.addEventListener('click', async () => {
            adminModal.style.display = 'flex';
            // Force reflow to ensure transition works
            void adminModal.offsetWidth;
            adminModal.classList.add('visible');
            clearAdminForm();

            // Load GitHub settings
            const token = localStorage.getItem('github_token');
            const username = localStorage.getItem('github_username') || '';
            const repo = localStorage.getItem('github_repo') || '';

            document.getElementById('githubUsername').value = username;
            document.getElementById('githubRepo').value = repo;
            // Don't load the token for security reasons

            // Check if GitHub settings are valid
            if (token && username && repo) {
                try {
                    // Quick check if token is still valid
                    const response = await fetch('https://api.github.com/user', {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (response.ok) {
                        const userData = await response.json();
                        console.log('GitHub token is valid for user:', userData.login);

                        // Show a small indicator that GitHub is connected
                        const githubStatus = document.createElement('div');
                        githubStatus.style.cssText = `
                            background: rgba(0, 255, 0, 0.1);
                            border: 1px solid rgba(0, 255, 0, 0.3);
                            color: #00ff00;
                            padding: 5px 10px;
                            border-radius: 5px;
                            font-size: 0.9rem;
                            margin-top: 5px;
                            text-align: center;
                        `;
                        githubStatus.textContent = `✓ GitHub connected as ${userData.login}`;

                        // Add it after the GitHub settings title
                        const titleElement = document.querySelector('h3[style*="color: var(--light-blue)"]');
                        if (titleElement) {
                            titleElement.insertAdjacentElement('afterend', githubStatus);
                        }
                    } else {
                        console.warn('GitHub token is invalid or expired');
                    }
                } catch (error) {
                    console.error('Error checking GitHub token:', error);
                }
            }
        });

        // Add handler for pushing current data to GitHub
        document.getElementById('pushToGitHub').addEventListener('click', async function() {
            try {
                // Check if GitHub settings are configured
                const token = localStorage.getItem('github_token');
                const username = localStorage.getItem('github_username');
                const repo = localStorage.getItem('github_repo');

                if (!token || !username || !repo) {
                    showAdminMessage('Please configure GitHub settings first', true);
                    return;
                }

                if (confirm('Are you sure you want to push the current data to GitHub?')) {
                    adminMessage.innerHTML = 'Pushing data to GitHub... <span class="loading-indicator"></span>';
                    adminMessage.className = 'admin-message success';
                    adminMessage.style.display = 'block';
                    const result = await saveToGitHub(allPlayers);
                    if (result) {
                        showAdminMessage('Successfully pushed data to GitHub!');
                    }
                }
            } catch (error) {
                console.error('Error pushing to GitHub:', error);
                showAdminMessage('Error pushing to GitHub: ' + error.message, true);
            }
        });

        // Add handler for checking data.json status
        document.getElementById('checkDataJson').addEventListener('click', async function() {
            try {
                // Check if GitHub settings are configured
                const token = localStorage.getItem('github_token');
                const username = localStorage.getItem('github_username');
                const repo = localStorage.getItem('github_repo');

                if (!token || !username || !repo) {
                    showAdminMessage('Please configure GitHub settings first', true);
                    return;
                }

                showAdminMessage('Checking data.json status...', false);

                // Check if data.json exists
                const path = 'data.json';
                const url = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.status === 404) {
                    showAdminMessage('data.json file does not exist in the repository. Use the "Create data.json" button to create it.', true);
                } else if (response.ok) {
                    const fileInfo = await response.json();
                    showAdminMessage(`data.json exists in the repository. SHA: ${fileInfo.sha.substring(0, 7)}...`);

                    // Try to decode and show some info about the file
                    try {
                        const content = atob(fileInfo.content);
                        const data = JSON.parse(content);
                        showAdminMessage(`data.json contains ${data.length} player records.`);
                    } catch (e) {
                        console.error('Error parsing file content:', e);
                    }
                } else {
                    const errorText = await response.text();
                    console.error('GitHub API error:', errorText);
                    showAdminMessage(`Error checking data.json: ${response.status} ${response.statusText}`, true);
                }
            } catch (error) {
                console.error('Error checking data.json:', error);
                showAdminMessage('Error checking data.json: ' + error.message, true);
            }
        });

        // Add handler for opening GitHub repository
        document.getElementById('openGitHubRepo').addEventListener('click', function() {
            const username = localStorage.getItem('github_username');
            const repo = localStorage.getItem('github_repo');

            if (!username || !repo) {
                showAdminMessage('Please configure GitHub settings first', true);
                return;
            }

            const repoUrl = `https://github.com/${username}/${repo}`;
            window.open(repoUrl, '_blank');
        });

        // Add handler for viewing data.json
        document.getElementById('viewDataJson').addEventListener('click', function() {
            const username = localStorage.getItem('github_username');
            const repo = localStorage.getItem('github_repo');

            if (!username || !repo) {
                showAdminMessage('Please configure GitHub settings first', true);
                return;
            }

            const dataJsonUrl = `https://github.com/${username}/${repo}/blob/main/data.json`;
            window.open(dataJsonUrl, '_blank');
        });

        // Add handler for creating data.json
        document.getElementById('createDataJson').addEventListener('click', async function() {
            try {
                // Check if GitHub settings are configured
                const token = localStorage.getItem('github_token');
                const username = localStorage.getItem('github_username');
                const repo = localStorage.getItem('github_repo');

                if (!token || !username || !repo) {
                    showAdminMessage('Please configure GitHub settings first', true);
                    return;
                }

                if (!confirm('This will create a new data.json file in your repository with the current player data. Continue?')) {
                    return;
                }

                showAdminMessage('Creating data.json file...', false);

                // Check if data.json already exists
                const path = 'data.json';
                const checkUrl = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;

                const checkResponse = await fetch(checkUrl, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (checkResponse.ok) {
                    showAdminMessage('data.json already exists in the repository. Use "Push Current Data" to update it.', true);
                    return;
                }

                // Helper function to safely encode Unicode strings to base64
                function utf8ToBase64(str) {
                    return btoa(unescape(encodeURIComponent(str)));
                }

                // Create the file
                const content = utf8ToBase64(JSON.stringify(allPlayers, null, 2));

                const createResponse = await fetch(checkUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Create data.json via web interface',
                        content: content
                    })
                });

                if (createResponse.ok) {
                    const result = await createResponse.json();
                    console.log('File created successfully:', result);
                    showAdminMessage('data.json file created successfully in your repository!');
                } else {
                    const errorText = await createResponse.text();
                    console.error('GitHub API error:', errorText);
                    showAdminMessage(`Error creating data.json: ${createResponse.status} ${createResponse.statusText}`, true);
                }
            } catch (error) {
                console.error('Error creating data.json:', error);
                showAdminMessage('Error creating data.json: ' + error.message, true);
            }
        });

        // Data import/export functionality
        document.getElementById('exportData').addEventListener('click', function() {
            try {
                const dataStr = JSON.stringify(allPlayers, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const dataUrl = URL.createObjectURL(dataBlob);

                const downloadLink = document.createElement('a');
                downloadLink.href = dataUrl;
                downloadLink.download = `No-Co_data_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);

                showAdminMessage('Data exported successfully!');
            } catch (error) {
                console.error('Error exporting data:', error);
                showAdminMessage('Error exporting data', true);
            }
        });

        document.getElementById('importData').addEventListener('click', function() {
            document.getElementById('fileInput').click();
        });

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            // Show loading indicator
            showAdminMessage('Reading file...', false);

            const reader = new FileReader();
            reader.onload = async function(event) {
                try {
                    const importedData = JSON.parse(event.target.result);

                    // Validate the data structure
                    if (!Array.isArray(importedData)) {
                        throw new Error('Invalid data format: not an array');
                    }

                    // Check if each item has the required fields
                    for (const item of importedData) {
                        if (!item.ign || !item.tier_earned) {
                            throw new Error('Invalid data format: missing required fields');
                        }
                    }

                    showAdminMessage(`Found ${importedData.length} player records. Processing...`, false);

                    // Confirm before overwriting
                    if (confirm(`Import ${importedData.length} player records? This will replace your current data.`)) {
                        // Add UUIDs if missing
                        showAdminMessage('Adding UUIDs to players...', false);
                        for (const player of importedData) {
                            if (!player.uuid) {
                                try {
                                    player.uuid = await getUUID(player.ign);
                                } catch (e) {
                                    console.warn(`Couldn't get UUID for ${player.ign}:`, e);
                                    // Generate a placeholder UUID
                                    player.uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                                        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                                        return v.toString(16);
                                    });
                                }
                            }
                        }

                        allPlayers = importedData;
                        updateUI();

                        // Push to GitHub
                        await saveToGitHub(allPlayers);

                        // Show success message
                        showAdminMessage(`Imported ${importedData.length} player records successfully!`);
                    } else {
                        showAdminMessage('Import cancelled', true);
                    }
                } catch (error) {
                    console.error('Error importing data:', error);
                    showAdminMessage('Error importing data: ' + error.message, true);
                }

                // Reset the file input
                e.target.value = '';
            };

            reader.onerror = function() {
                showAdminMessage('Error reading file', true);
                e.target.value = '';
            };

            reader.readAsText(file);
        });



        document.getElementById('clearData').addEventListener('click', function() {
            if (confirm('Are you sure you want to RESET ALL DATA? This cannot be undone!')) {
                if (confirm('FINAL WARNING: All player data will be permanently deleted. Continue?')) {
                    // Clear the data
                    allPlayers = [];
                    updateUI();
                    showAdminMessage('All data has been reset. Reload the page to restore data from GitHub.');
                }
            }
        });

        document.getElementById('debugData').addEventListener('click', async function() {
            try {
                // Create debug info
                const debugInfo = {
                    timestamp: new Date().toISOString(),
                    currentData: {
                        playerCount: allPlayers.length,
                        hasKytsue: allPlayers.some(p => p.ign.toLowerCase() === 'kytsue'),
                        playerNames: allPlayers.map(p => p.ign)
                    },
                    dataJson: {
                        fetchAttempt: null,
                        status: null,
                        playerCount: null,
                        hasKytsue: null,
                        error: null
                    }
                };

                // Try to fetch data.json
                try {
                    debugInfo.dataJson.fetchAttempt = true;
                    const response = await fetch('data.json?nocache=' + new Date().getTime());
                    debugInfo.dataJson.status = response.status;

                    if (response.ok) {
                        const data = await response.json();
                        debugInfo.dataJson.playerCount = data.length;
                        debugInfo.dataJson.hasKytsue = data.some(p => p.ign.toLowerCase() === 'kytsue');
                        debugInfo.dataJson.playerNames = data.map(p => p.ign);
                    }
                } catch (error) {
                    debugInfo.dataJson.error = error.message;
                }

                // Display debug info
                console.log('Debug Info:', debugInfo);

                // Create a formatted display
                const debugDisplay = document.createElement('div');
                debugDisplay.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.95);
                    color: white;
                    padding: 20px;
                    border-radius: 10px;
                    max-width: 80%;
                    max-height: 80%;
                    overflow: auto;
                    z-index: 2000;
                    font-family: monospace;
                    white-space: pre-wrap;
                    border: 2px solid var(--light-blue);
                `;

                debugDisplay.innerHTML = `
                    <h3 style="color: var(--light-blue);">Debug Information</h3>
                    <pre>${JSON.stringify(debugInfo, null, 2)}</pre>
                    <button id="closeDebug" style="
                        background: var(--light-blue);
                        border: none;
                        padding: 8px 16px;
                        border-radius: 5px;
                        color: white;
                        cursor: pointer;
                        margin-top: 15px;
                    ">Close</button>
                    <button id="copyDebug" style="
                        background: var(--dark-blue);
                        border: none;
                        padding: 8px 16px;
                        border-radius: 5px;
                        color: white;
                        cursor: pointer;
                        margin-top: 15px;
                        margin-left: 10px;
                    ">Copy to Clipboard</button>
                `;

                document.body.appendChild(debugDisplay);

                document.getElementById('closeDebug').addEventListener('click', function() {
                    document.body.removeChild(debugDisplay);
                });

                document.getElementById('copyDebug').addEventListener('click', function() {
                    navigator.clipboard.writeText(JSON.stringify(debugInfo, null, 2))
                        .then(() => {
                            this.textContent = 'Copied!';
                            setTimeout(() => {
                                this.textContent = 'Copy to Clipboard';
                            }, 2000);
                        })
                        .catch(err => {
                            console.error('Failed to copy: ', err);
                            this.textContent = 'Failed to copy';
                        });
                });

                // Also add a direct way to add Kytsue if missing
                if (!debugInfo.currentData.hasKytsue) {
                    const addKytsueButton = document.createElement('button');
                    addKytsueButton.textContent = 'Add Kytsue to Data';
                    addKytsueButton.style.cssText = `
                        background: #4CAF50;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 5px;
                        color: white;
                        cursor: pointer;
                        margin-top: 15px;
                        margin-left: 10px;
                    `;
                    debugDisplay.appendChild(addKytsueButton);

                    addKytsueButton.addEventListener('click', async function() {
                        try {
                            const uuid = await getUUID('kytsue');
                            allPlayers.push({
                                tier_before: "Unranked",
                                tier_earned: "HT2",
                                ign: "kytsue",
                                tester: "729405047644880968",
                                timestamp: "2025-03-08 19:33:31.842327+00:00",
                                uuid: uuid
                            });

                            updateUI();
                            await saveToGitHub(allPlayers);

                            this.textContent = 'Kytsue Added!';
                            this.disabled = true;
                            this.style.background = '#888';
                        } catch (error) {
                            console.error('Error adding Kytsue:', error);
                            this.textContent = 'Error Adding Kytsue';
                            this.style.background = '#F44336';
                        }
                    });
                }

            } catch (error) {
                console.error('Error generating debug info:', error);
                showAdminMessage('Error generating debug info: ' + error.message, true);
            }
        });

        // Add loading indicator
        function showLoading(show) {
            const container = document.querySelector('.container');
            let loadingEl = document.getElementById('loadingIndicator');

            if (show) {
                if (!loadingEl) {
                    loadingEl = document.createElement('div');
                    loadingEl.id = 'loadingIndicator';
                    loadingEl.style.cssText = `
                        position: fixed;
                        top: 10px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: rgba(0, 0, 0, 0.7);
                        color: white;
                        padding: 5px 15px;
                        border-radius: 20px;
                        font-size: 14px;
                        z-index: 100;
                        opacity: 0;
                        transition: opacity 0.3s;
                    `;
                    loadingEl.textContent = 'Aggiornamento dati...';
                    document.body.appendChild(loadingEl);

                    // Force reflow
                    void loadingEl.offsetWidth;
                    loadingEl.style.opacity = '1';
                }
            } else if (loadingEl) {
                loadingEl.style.opacity = '0';
                setTimeout(() => {
                    if (loadingEl.parentNode) {
                        loadingEl.parentNode.removeChild(loadingEl);
                    }
                }, 300);
            }
        }

        // Throttle data loading to prevent excessive requests
        let isLoadingData = false;
        let lastLoadTime = 0;
        const LOAD_THROTTLE_TIME = 30000; // 30 seconds minimum between loads

        async function throttledLoadData() {
            if (isLoadingData) return;

            const now = Date.now();
            if (now - lastLoadTime < LOAD_THROTTLE_TIME) {
                console.log('Throttling data load, last load was', Math.round((now - lastLoadTime)/1000), 'seconds ago');
                return;
            }

            isLoadingData = true;
            showLoading(true);

            try {
                await loadData();
                lastLoadTime = Date.now();
            } catch (error) {
                console.error('Error loading data:', error);
            } finally {
                isLoadingData = false;
                showLoading(false);
            }
        }

        // Add filter button event listeners
        document.getElementById('filterAll').addEventListener('click', function() {
            if (currentFilter !== 'all') {
                currentFilter = 'all';
                updateUI();
            }
        });

        document.getElementById('filterAnemoia').addEventListener('click', function() {
            if (currentFilter !== 'Anemoia') {
                currentFilter = 'Anemoia';
                updateUI();
            }
        });

        // Load data every 5 minutes to reduce server load and improve performance
        setInterval(throttledLoadData, 300000);
        throttledLoadData();

        // Theme toggle functionality
        const themeToggle = document.getElementById('themeToggle');
        themeToggle.addEventListener('click', function() {
            const body = document.body;
            const isDarkTheme = !body.classList.contains('light-theme');

            if (isDarkTheme) {
                // Switch to light theme
                body.classList.add('light-theme');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i><span>Tema Chiaro</span>';
                localStorage.setItem('theme', 'light');
            } else {
                // Switch to dark theme
                body.classList.remove('light-theme');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i><span>Tema Scuro</span>';
                localStorage.setItem('theme', 'dark');
            }

            // Refresh charts if they exist and stats page is visible
            if (document.getElementById('page-stats').style.display === 'block') {
                if (window.tierChart) {
                    createTierDistributionChart();
                }
                if (window.activityChart) {
                    createMonthlyActivityChart();
                }
            }
        });

        // Check for saved theme preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-theme');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i><span>Tema Chiaro</span>';
        }

        // Navigation functionality
        const navItems = document.querySelectorAll('.nav-item');
        const pages = document.querySelectorAll('.page-content');

        navItems.forEach(item => {
            item.addEventListener('click', function() {
                const targetPage = this.getAttribute('data-page');

                // Update active nav item
                navItems.forEach(navItem => navItem.classList.remove('active'));
                this.classList.add('active');

                // Show target page, hide others
                pages.forEach(page => {
                    if (page.id === `page-${targetPage}`) {
                        page.style.display = 'block';
                    } else {
                        page.style.display = 'none';
                    }
                });

                // Close sidebar on mobile after navigation
                if (window.innerWidth <= 992) {
                    document.getElementById('sidebar').classList.remove('active');
                }

                // Load page-specific data
                if (targetPage === 'stats') {
                    loadStats();
                } else if (targetPage === 'activity') {
                    loadActivity();
                } else if (targetPage === 'leaderboard-xp') {
                    loadXPLeaderboard();
                } else if (targetPage === 'matchmaking') {
                    loadMatchmakingStatus();
                }
            });
        });

        // Mobile sidebar toggle
        const sidebarToggle = document.getElementById('sidebarToggle');
        sidebarToggle.addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        });

        // Stats page functionality
        function loadStats() {
            // Calculate statistics from player data
            const totalPlayers = allPlayers.length;
            const AnemoiaPlayers = allPlayers.filter(player => player.Anemoia).length;

            // Count tests this month
            const now = new Date();
            const thisMonth = now.getMonth();
            const thisYear = now.getFullYear();

            const testsThisMonth = allPlayers.filter(player => {
                const timestamp = new Date(player.timestamp);
                return timestamp.getMonth() === thisMonth && timestamp.getFullYear() === thisYear;
            }).length;

            // Update stats cards
            document.getElementById('totalPlayersCount').textContent = totalPlayers;
            document.getElementById('AnemoiaCount').textContent = AnemoiaPlayers;
            document.getElementById('testsThisMonth').textContent = testsThisMonth;

            // Create tier distribution chart
            createTierDistributionChart();

            // Create monthly activity chart
            createMonthlyActivityChart();
        }

        function createTierDistributionChart() {
            const tierCounts = {};
            const tierOrder = [
                "HT1", "LT1",
                "HT2", "LT2",
                "HT3", "LT3",
                "HT4", "LT4",
                "HT5", "LT5"
            ];

            // Initialize counts for all tiers to ensure they all appear in the chart
            tierOrder.forEach(tier => {
                tierCounts[tier] = 0;
            });

            // Count players in each tier
            allPlayers.forEach(player => {
                const tier = player.tier_earned;
                if (tier && tierOrder.includes(tier)) {
                    tierCounts[tier] = (tierCounts[tier] || 0) + 1;
                }
            });

            // Prepare data for chart using the predefined order
            const labels = tierOrder;
            const data = labels.map(tier => tierCounts[tier]);

            // Create chart
            const ctx = document.getElementById('tierDistributionChart').getContext('2d');

            // Destroy existing chart if it exists
            if (window.tierChart) {
                window.tierChart.destroy();
            }

            // Check if light theme is active
            const isLightTheme = document.body.classList.contains('light-theme');

            // Create a gradient for the bars based on theme
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            if (isLightTheme) {
                gradient.addColorStop(0, 'rgba(79, 70, 229, 0.8)');
                gradient.addColorStop(1, 'rgba(129, 140, 248, 0.8)');
            } else {
                gradient.addColorStop(0, 'rgba(102, 163, 255, 0.8)');
                gradient.addColorStop(1, 'rgba(79, 70, 229, 0.8)');
            }

            // Set colors based on theme
            const textColor = isLightTheme ? 'rgba(0, 0, 0, 0.7)' : 'rgba(255, 255, 255, 0.7)';
            const gridColor = isLightTheme ? 'rgba(0, 0, 0, 0.1)' : 'rgba(255, 255, 255, 0.1)';
            const titleColor = isLightTheme ? 'rgba(0, 0, 0, 0.9)' : 'rgba(255, 255, 255, 0.9)';
            const tooltipBgColor = isLightTheme ? 'rgba(255, 255, 255, 0.9)' : 'rgba(0, 0, 0, 0.8)';
            const tooltipTextColor = isLightTheme ? 'rgba(0, 0, 0, 0.9)' : 'rgba(255, 255, 255, 1)';
            const borderColor = isLightTheme ? 'rgba(79, 70, 229, 1)' : 'rgba(102, 163, 255, 1)';

            window.tierChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Giocatori per Tier',
                        data: data,
                        backgroundColor: gradient,
                        borderColor: borderColor,
                        borderWidth: 1,
                        borderRadius: 6,
                        barPercentage: 0.7,
                        categoryPercentage: 0.8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0,
                                color: textColor
                            },
                            grid: {
                                color: gridColor
                            }
                        },
                        x: {
                            ticks: {
                                color: textColor
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: textColor
                            }
                        },
                        title: {
                            display: true,
                            text: 'Distribuzione dei Tier',
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: titleColor,
                            padding: {
                                top: 10,
                                bottom: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: tooltipBgColor,
                            titleColor: tooltipTextColor,
                            bodyColor: tooltipTextColor,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return `${context.parsed.y} giocatori`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createMonthlyActivityChart() {
            // Group tests by month
            const monthlyTests = {};
            const monthNames = ["Gen", "Feb", "Mar", "Apr", "Mag", "Giu", "Lug", "Ago", "Set", "Ott", "Nov", "Dic"];

            allPlayers.forEach(player => {
                if (player.timestamp) {
                    const timestamp = new Date(player.timestamp);
                    if (!isNaN(timestamp.getTime())) { // Check if date is valid
                        const monthYear = `${timestamp.getFullYear()}-${timestamp.getMonth() + 1}`;
                        monthlyTests[monthYear] = (monthlyTests[monthYear] || 0) + 1;
                    }
                }
            });

            // Get last 12 months
            const now = new Date();
            const labels = [];
            const data = [];

            for (let i = 11; i >= 0; i--) {
                const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const monthYear = `${d.getFullYear()}-${d.getMonth() + 1}`;
                const monthName = monthNames[d.getMonth()];

                labels.push(monthName);
                data.push(monthlyTests[monthYear] || 0);
            }

            // Create chart
            const ctx = document.getElementById('monthlyActivityChart').getContext('2d');

            // Destroy existing chart if it exists
            if (window.activityChart) {
                window.activityChart.destroy();
            }

            // Check if light theme is active
            const isLightTheme = document.body.classList.contains('light-theme');

            // Set colors based on theme
            const textColor = isLightTheme ? 'rgba(0, 0, 0, 0.7)' : 'rgba(255, 255, 255, 0.7)';
            const gridColor = isLightTheme ? 'rgba(0, 0, 0, 0.1)' : 'rgba(255, 255, 255, 0.1)';
            const titleColor = isLightTheme ? 'rgba(0, 0, 0, 0.9)' : 'rgba(255, 255, 255, 0.9)';
            const tooltipBgColor = isLightTheme ? 'rgba(255, 255, 255, 0.9)' : 'rgba(0, 0, 0, 0.8)';
            const tooltipTextColor = isLightTheme ? 'rgba(0, 0, 0, 0.9)' : 'rgba(255, 255, 255, 1)';

            // Create gradient for the area based on theme
            const areaGradient = ctx.createLinearGradient(0, 0, 0, 400);
            let borderColor, pointBgColor;

            if (isLightTheme) {
                areaGradient.addColorStop(0, 'rgba(249, 115, 22, 0.4)');
                areaGradient.addColorStop(1, 'rgba(249, 115, 22, 0.0)');
                borderColor = 'rgba(234, 88, 12, 1)';
                pointBgColor = 'rgba(234, 88, 12, 1)';
            } else {
                areaGradient.addColorStop(0, 'rgba(255, 215, 0, 0.4)');
                areaGradient.addColorStop(1, 'rgba(255, 215, 0, 0.0)');
                borderColor = 'rgba(255, 215, 0, 1)';
                pointBgColor = 'rgba(255, 215, 0, 1)';
            }

            window.activityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Test Mensili',
                        data: data,
                        backgroundColor: areaGradient,
                        borderColor: borderColor,
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: pointBgColor,
                        pointBorderColor: isLightTheme ? '#fff' : '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0,
                                color: textColor
                            },
                            grid: {
                                color: gridColor
                            }
                        },
                        x: {
                            ticks: {
                                color: textColor
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: textColor
                            }
                        },
                        title: {
                            display: true,
                            text: 'Attività Mensile',
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            color: titleColor,
                            padding: {
                                top: 10,
                                bottom: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: tooltipBgColor,
                            titleColor: tooltipTextColor,
                            bodyColor: tooltipTextColor,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return `${context.parsed.y} test`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Activity page functionality
        function loadActivity() {
            const activityContainer = document.getElementById('activityContainer');

            // Sort players by timestamp (most recent first)
            const recentActivity = [...allPlayers].sort((a, b) => {
                return new Date(b.timestamp) - new Date(a.timestamp);
            }).slice(0, 20); // Get most recent 20 activities

            if (recentActivity.length === 0) {
                activityContainer.innerHTML = '<div class="activity-empty">Nessuna attività recente</div>';
                return;
            }

            let activityHTML = '<div class="activity-timeline">';

            recentActivity.forEach(activity => {
                const timestamp = new Date(activity.timestamp);
                const formattedDate = timestamp.toLocaleDateString('it-IT', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                });

                const formattedTime = timestamp.toLocaleTimeString('it-IT', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const tierChange = activity.tier_before !== activity.tier_earned;
                const tierUpgrade = tierChange && getTierValue(activity.tier_earned) > getTierValue(activity.tier_before);
                const tierDowngrade = tierChange && getTierValue(activity.tier_earned) < getTierValue(activity.tier_before);

                let statusIcon = '';
                let statusClass = '';

                if (tierUpgrade) {
                    statusIcon = '<i class="fas fa-arrow-up"></i>';
                    statusClass = 'activity-upgrade';
                } else if (tierDowngrade) {
                    statusIcon = '<i class="fas fa-arrow-down"></i>';
                    statusClass = 'activity-downgrade';
                } else {
                    statusIcon = '<i class="fas fa-equals"></i>';
                    statusClass = 'activity-same';
                }

                activityHTML += `
                    <div class="activity-item ${statusClass}">
                        <div class="activity-time">
                            <div class="activity-date">${formattedDate}</div>
                            <div class="activity-hour">${formattedTime}</div>
                        </div>
                        <div class="activity-icon">${statusIcon}</div>
                        <div class="activity-content">
                            <div class="activity-title">
                                <span class="activity-player">${activity.ign}</span>
                                ${activity.Anemoia ? '<span class="activity-Anemoia"><i class="fas fa-crown"></i></span>' : ''}
                            </div>
                            <div class="activity-details">
                                <span class="activity-tier-before">${activity.tier_before}</span>
                                <span class="activity-arrow">→</span>
                                <span class="activity-tier-after">${activity.tier_earned}</span>
                            </div>
                        </div>
                    </div>
                `;
            });

            activityHTML += '</div>';
            activityContainer.innerHTML = activityHTML;
        }

        // Helper function to get numeric value of tier for comparison
        function getTierValue(tier) {
            const tierMap = {
                'Unranked': 0,
                'LT5': 1, 'HT5': 2,
                'LT4': 3, 'HT4': 4,
                'LT3': 5, 'HT3': 6,
                'LT2': 7, 'HT2': 8,
                'LT1': 9, 'HT1': 10
            };

            return tierMap[tier] || 0;
        }

        // XP Leaderboard functionality
        function loadXPLeaderboard() {
            const container = document.getElementById('xpLeaderboardContainer');

            // This would normally fetch data from the server
            // For demo purposes, we'll create mock data
            const mockXPData = [
                { id: 1, username: 'Player1', xp: 5240, level: 12, avatar: 'https://i.pravatar.cc/100?img=1' },
                { id: 2, username: 'Player2', xp: 4980, level: 11, avatar: 'https://i.pravatar.cc/100?img=2' },
                { id: 3, username: 'Player3', xp: 4750, level: 10, avatar: 'https://i.pravatar.cc/100?img=3' },
                { id: 4, username: 'Player4', xp: 3890, level: 9, avatar: 'https://i.pravatar.cc/100?img=4' },
                { id: 5, username: 'Player5', xp: 3540, level: 8, avatar: 'https://i.pravatar.cc/100?img=5' },
                { id: 6, username: 'Player6', xp: 3210, level: 7, avatar: 'https://i.pravatar.cc/100?img=6' },
                { id: 7, username: 'Player7', xp: 2980, level: 7, avatar: 'https://i.pravatar.cc/100?img=7' },
                { id: 8, username: 'Player8', xp: 2450, level: 6, avatar: 'https://i.pravatar.cc/100?img=8' },
                { id: 9, username: 'Player9', xp: 2100, level: 5, avatar: 'https://i.pravatar.cc/100?img=9' },
                { id: 10, username: 'Player10', xp: 1890, level: 4, avatar: 'https://i.pravatar.cc/100?img=10' }
            ];

            let html = '<div class="xp-leaderboard">';

            // Top 3 players with special styling
            html += '<div class="xp-top-players">';

            for (let i = 0; i < 3 && i < mockXPData.length; i++) {
                const player = mockXPData[i];
                const medal = i === 0 ? '🥇' : i === 1 ? '🥈' : '🥉';

                html += `
                    <div class="xp-top-player">
                        <div class="xp-top-medal">${medal}</div>
                        <div class="xp-top-avatar">
                            <img src="${player.avatar}" alt="${player.username}">
                            <div class="xp-top-level">Lvl ${player.level}</div>
                        </div>
                        <div class="xp-top-info">
                            <div class="xp-top-name">${player.username}</div>
                            <div class="xp-top-xp">${player.xp.toLocaleString()} XP</div>
                        </div>
                    </div>
                `;
            }

            html += '</div>';

            // Rest of the leaderboard
            html += '<div class="xp-players-list">';

            for (let i = 3; i < mockXPData.length; i++) {
                const player = mockXPData[i];

                html += `
                    <div class="xp-player-item">
                        <div class="xp-player-rank">#${i + 1}</div>
                        <div class="xp-player-avatar">
                            <img src="${player.avatar}" alt="${player.username}">
                        </div>
                        <div class="xp-player-info">
                            <div class="xp-player-name">${player.username}</div>
                            <div class="xp-player-level">Livello ${player.level}</div>
                        </div>
                        <div class="xp-player-xp">${player.xp.toLocaleString()} XP</div>
                    </div>
                `;
            }

            html += '</div>';
            html += '</div>';

            container.innerHTML = html;
        }

        // Matchmaking functionality
        function loadMatchmakingStatus() {
            // This would normally fetch data from the server
            // For demo purposes, we'll create mock data
            const mockQueueData = {
                duo: [
                    { id: 1, username: 'Player1', avatar: 'https://i.pravatar.cc/100?img=1' },
                    { id: 2, username: 'Player2', avatar: 'https://i.pravatar.cc/100?img=2' }
                ],
                trio: [
                    { id: 3, username: 'Player3', avatar: 'https://i.pravatar.cc/100?img=3' },
                    { id: 4, username: 'Player4', avatar: 'https://i.pravatar.cc/100?img=4' }
                ]
            };

            // Update duo queue
            const duoQueueCount = document.getElementById('duoQueueCount');
            const duoQueuePlayers = document.getElementById('duoQueuePlayers');

            duoQueueCount.textContent = `${mockQueueData.duo.length}/2`;

            if (mockQueueData.duo.length === 0) {
                duoQueuePlayers.innerHTML = '<div class="empty-queue">Nessun giocatore in coda</div>';
            } else {
                let duoHTML = '';
                mockQueueData.duo.forEach(player => {
                    duoHTML += `
                        <div class="queue-player">
                            <img src="${player.avatar}" alt="${player.username}">
                            <span>${player.username}</span>
                        </div>
                    `;
                });
                duoQueuePlayers.innerHTML = duoHTML;
            }

            // Update trio queue
            const trioQueueCount = document.getElementById('trioQueueCount');
            const trioQueuePlayers = document.getElementById('trioQueuePlayers');

            trioQueueCount.textContent = `${mockQueueData.trio.length}/3`;

            if (mockQueueData.trio.length === 0) {
                trioQueuePlayers.innerHTML = '<div class="empty-queue">Nessun giocatore in coda</div>';
            } else {
                let trioHTML = '';
                mockQueueData.trio.forEach(player => {
                    trioHTML += `
                        <div class="queue-player">
                            <img src="${player.avatar}" alt="${player.username}">
                            <span>${player.username}</span>
                        </div>
                    `;
                });
                trioQueuePlayers.innerHTML = trioHTML;
            }

            // Add event listeners to queue buttons
            document.querySelectorAll('.queue-button').forEach(button => {
                button.addEventListener('click', function() {
                    const queueType = this.getAttribute('data-queue');
                    alert(`Funzionalità di coda ${queueType} non disponibile nella demo. Usa il comando !queue ${queueType} su Discord.`);
                });
            });
        }
    </script>
</body>
</html>
